{
  "hash": "70d23c0c84e4fa4d28307cfd2d6e925d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 02\"\nauthor: \"Henry Low\"\ndate: \"Sep 25 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  evalu: true\n  context: shared\n  echo: true\n  message: false\n  freeze: true\nformat: html\neditor: visual\ndate-format: \"DD MM YYYY\"\n---\n\n\n\n# Background\n\nTourism has been a key driver of Thailand's gross domestic product (GDP), accounting for up to 20% of it. The COVID-19 pandemic caused the tourism revenue (from domestic and international tourism) to crash to US\\$24 billion in 2020, from US\\$90 billion in 2019.\n\n# Objectives\n\nUsing appropriate global and local spatial autocorrelation analysis and emerging hotspot analysis, I would like to find out:\\\n- If the key indicators of tourism economy of Thailand are independent from space and space and time.\\\n- If the tourism economy is indeed spatial and spatio-temporal dependent.\\\n- If so, detect where the clusters and outliers are, and the emerging hotpot and cold spot areas.\n\n# Study Area\n\nThe study area will be Thailand (sf_polygon features) at [province](https://en.wikipedia.org/wiki/Provinces_of_Thailand) level.\n\n# Data Sources\n\n*(saved under 'data' folder)*\\\n[Thailand Domestic Tourism Statistics 2019-2023](https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics) from Kaggle\\\n[Thailand - Subnational Administrative Boundaries from HDX](https://data.humdata.org/dataset/cod-ab-tha?)...[Click here to download here](https://data.humdata.org/dataset/d24bdc45-eb4c-4e3d-8b16-44db02667c27/resource/d0c722ff-6939-4423-ac0d-6501830b1759/download/tha_adm_rtsd_itos_20210121_shp.zip)\n\n# 1 Setting Up\n\n## 1.1 Loading R Packages\n\nI will be using the following R packages:\\\n-`sf` package to perform geospatial wrangling tasks \\\n- `sfdep` package to perform spatial autocorrelation analysis and emerging hotspot analysis \\\n- `tidyverse` package for reading csv files, dataframe processing tasks \\\n- `ggplot2` and `ggpubr` package for plotting statistical graphics \\\n- `DT`, `crosstalk` and `htmltools`, package for visualizing results in a table format \\\n- `Kendall` package for performing and visualizing Mann-Kendall Test \\\n- `tmap` package for plotting tasks \\\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sfdep, sf, ggplot2, ggpubr, tmap, DT, crosstalk, htmltools, Kendall)\n```\n:::\n\n\n\n## 1.2 Loading Datasets\n\nThe aim here is to load the datasets and do the necessary geospatial data wrangling before proceeding to the subsequent steps.\n\n### 1.2.1 Thailand Subnational Adminstrative Boundaries\n\n`st_read` from the sf package is used to load the subnational boundaries.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load Thailand Province from HDX\nth_bound_l1 <- st_read(dsn = \"data/tha_adm_rtsd_itos_20210121_shp/\", layer = \"tha_admbnda_adm1_rtsd_20220121\") %>%\n  st_transform(crs = 32647) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm1_rtsd_20220121' from data source \n  `C:\\Users\\Henry\\Desktop\\SMU Masters\\2024-2025 T1\\Geospatial Analytics & Applications\\Project\\GeospatialWebsite\\Take-Home_Ex\\Take-Home_Ex_02\\data\\tha_adm_rtsd_itos_20210121_shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n# Check output\nglimpse(th_bound_l1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 77\nColumns: 17\n$ Shape_Leng <dbl> 2.417227, 1.695100, 1.251111, 1.884945, 3.041716, 1.739908,…\n$ Shape_Area <dbl> 0.13133873, 0.07926199, 0.05323766, 0.12698345, 0.21393797,…\n$ ADM1_EN    <chr> \"Bangkok\", \"Samut Prakan\", \"Nonthaburi\", \"Pathum Thani\", \"P…\n$ ADM1_TH    <chr> \"กรุงเทพมหานคร\", \"สมุทรปราการ\", \"นนทบุรี\", \"ปทุมธานี\", \"พระนครศรีอ…\n$ ADM1_PCODE <chr> \"TH10\", \"TH11\", \"TH12\", \"TH13\", \"TH14\", \"TH15\", \"TH16\", \"TH…\n$ ADM1_REF   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ ADM1ALT1EN <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ ADM1ALT2EN <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ ADM1ALT1TH <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ ADM1ALT2TH <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ ADM0_EN    <chr> \"Thailand\", \"Thailand\", \"Thailand\", \"Thailand\", \"Thailand\",…\n$ ADM0_TH    <chr> \"ประเทศไทย\", \"ประเทศไทย\", \"ประเทศไทย\", \"ประเทศไทย\", \"ประเทศ…\n$ ADM0_PCODE <chr> \"TH\", \"TH\", \"TH\", \"TH\", \"TH\", \"TH\", \"TH\", \"TH\", \"TH\", \"TH\",…\n$ date       <date> 2019-02-18, 2019-02-18, 2019-02-18, 2019-02-18, 2019-02-18…\n$ validOn    <date> 2022-01-22, 2022-01-22, 2022-01-22, 2022-01-22, 2022-01-22…\n$ validTo    <date> -001-11-30, -001-11-30, -001-11-30, -001-11-30, -001-11-30…\n$ geometry   <MULTIPOLYGON [m]> MULTIPOLYGON (((674339.8 15..., MULTIPOLYGON (…\n```\n\n\n:::\n:::\n\n\n\n### 1.2.2 Thailand Tourism Data\n\n`read_csv` from readr package within tidyverse is used to load the aspatial data as a tibble.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_tourism <- read_csv('data/archive/thailand_domestic_tourism_2019_2023_ver2.csv')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 30800 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (5): province_thai, province_eng, region_thai, region_eng, variable\ndbl  (1): value\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nglimpse(tbl_tourism)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 30,800\nColumns: 7\n$ date          <date> 2019-01-01, 2019-01-01, 2019-01-01, 2019-01-01, 2019-01…\n$ province_thai <chr> \"กรุงเทพมหานคร\", \"ลพบุรี\", \"พระนครศรีอยุธยา\", \"สระบุรี\", \"ชัยนาท…\n$ province_eng  <chr> \"Bangkok\", \"Lopburi\", \"Phra Nakhon Si Ayutthaya\", \"Sarab…\n$ region_thai   <chr> \"ภาคกลาง\", \"ภาคกลาง\", \"ภาคกลาง\", \"ภาคกลาง\", \"ภาคกลาง\", \"…\n$ region_eng    <chr> \"central\", \"central\", \"central\", \"central\", \"central\", \"…\n$ variable      <chr> \"ratio_tourist_stay\", \"ratio_tourist_stay\", \"ratio_touri…\n$ value         <dbl> 93.37, 61.32, 73.37, 67.33, 79.31, 71.70, 64.65, 71.21, …\n```\n\n\n:::\n:::\n\n\n\nBefore joining the 2 datasets, we need to check if there are any non-matching values in either joining columns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find values in Th bound that are not in Tourism Data\nonly_in_th_bound_l1 <- anti_join(th_bound_l1, tbl_tourism, by = c(\"ADM1_EN\" = \"province_eng\")) %>% pull(ADM1_EN)\n\n# Find values in Tourism Data that are not in Th Bound\nonly_in_tbl_tourism <- anti_join(tbl_tourism, th_bound_l1, by = c(\"province_eng\" = \"ADM1_EN\")) %>% pull(province_eng)\n\n# See all values\nunmatched_values <- union(only_in_th_bound_l1, only_in_tbl_tourism)\nprint(unmatched_values)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Lop Buri\"         \"Chai Nat\"         \"Chon Buri\"        \"Prachin Buri\"    \n [5] \"Buri Ram\"         \"Si Sa Ket\"        \"Nong Bua Lam Phu\" \"Phangnga\"        \n [9] \"Lopburi\"          \"Chainat\"          \"Chonburi\"         \"Prachinburi\"     \n[13] \"Phang Nga\"        \"Buriram\"          \"Sisaket\"          \"Nong Bua Lamphu\" \n```\n\n\n:::\n:::\n\n\n\nSince we found the discrepancies, minor re-coding is required to ensure that values are aligned. The KPIs are also pivoted from long to wide to facilitate future analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data processing\ntbl_tourism_wide <- tbl_tourism %>%\n  mutate(province_eng = recode(province_eng,\n                       \"Lopburi\" = \"Lop Buri\",\n                       \"Chainat\" = \"Chai Nat\",\n                       \"Chonburi\" = \"Chon Buri\",\n                       \"Prachinburi\" = \"Prachin Buri\",\n                       \"Phang Nga\" = \"Phangnga\",\n                       \"Buriram\" = \"Buri Ram\",\n                       \"Sisaket\" = \"Si Sa Ket\",\n                       \"Nong Bua Lamphu\" = \"Nong Bua Lam Phu\"\n                       ),\n         province_eng = trimws(province_eng)\n         ) %>%\n  pivot_wider(., names_from = \"variable\", values_from = \"value\")\n\n# Check output\nsummary(tbl_tourism_wide)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      date            province_thai      province_eng       region_thai       \n Min.   :2019-01-01   Length:3850        Length:3850        Length:3850       \n 1st Qu.:2020-01-01   Class :character   Class :character   Class :character  \n Median :2021-01-16   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2021-01-15                                                           \n 3rd Qu.:2022-02-01                                                           \n Max.   :2023-02-01                                                           \n  region_eng        ratio_tourist_stay no_tourist_stay   no_tourist_all   \n Length:3850        Min.   : 0.00      Min.   :      0   Min.   :      0  \n Class :character   1st Qu.:20.18      1st Qu.:  16271   1st Qu.:  39092  \n Mode  :character   Median :41.81      Median :  44579   Median :  92122  \n                    Mean   :38.93      Mean   : 105161   Mean   : 206328  \n                    3rd Qu.:56.20      3rd Qu.:  90902   3rd Qu.: 203646  \n                    Max.   :95.86      Max.   :3335728   Max.   :6131044  \n no_tourist_thai   no_tourist_foreign   revenue_all         revenue_thai      \n Min.   :      0   Min.   :      0.0   Min.   :0.000e+00   Min.   :0.000e+00  \n 1st Qu.:  37169   1st Qu.:     49.2   1st Qu.:6.332e+07   1st Qu.:5.925e+07  \n Median :  88782   Median :    553.0   Median :1.955e+08   Median :1.773e+08  \n Mean   : 173962   Mean   :  32366.1   Mean   :1.344e+09   Mean   :6.636e+08  \n 3rd Qu.: 184256   3rd Qu.:   5189.5   3rd Qu.:5.060e+08   3rd Qu.:4.600e+08  \n Max.   :4087756   Max.   :2473725.0   Max.   :1.103e+11   Max.   :4.506e+10  \n revenue_foreign     \n Min.   :-4.250e+03  \n 1st Qu.: 1.100e+05  \n Median : 1.540e+06  \n Mean   : 6.802e+08  \n 3rd Qu.: 1.742e+07  \n Max.   : 8.503e+10  \n```\n\n\n:::\n:::\n\n\n\nThere are some weird values in revenue_foreign (negative), more investigation is required. Furthermore, it was picked up for some rows no_tourist_stay is greater than no_tourist_all, which should not be possible.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_tourism_wide %>%\n  filter(revenue_foreign < 0 | no_tourist_stay > no_tourist_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 13\n  date       province_thai province_eng  region_thai region_eng\n  <date>     <chr>         <chr>         <chr>       <chr>     \n1 2020-03-01 ตราด          Trat          ภาคตะวันออก  east      \n2 2020-05-01 เชียงใหม่       Chiang Mai    ภาคเหนือ     north     \n3 2020-06-01 ชลบุรี          Chon Buri     ภาคตะวันออก  east      \n4 2021-07-01 นครปฐม        Nakhon Pathom ภาคกลาง     central   \n5 2020-08-01 ยะลา          Yala          ภาคใต้       south     \n6 2021-08-01 นครปฐม        Nakhon Pathom ภาคกลาง     central   \n7 2021-08-01 จันทบุรี         Chanthaburi   ภาคตะวันออก  east      \n8 2020-12-01 สมุทรสาคร      Samut Sakhon  ภาคกลาง     central   \n# ℹ 8 more variables: ratio_tourist_stay <dbl>, no_tourist_stay <dbl>,\n#   no_tourist_all <dbl>, no_tourist_thai <dbl>, no_tourist_foreign <dbl>,\n#   revenue_all <dbl>, revenue_thai <dbl>, revenue_foreign <dbl>\n```\n\n\n:::\n:::\n\n\n\nSince this anomaly only pertains to a few rows of data, I'll assume data entry error and re-code those revenue_foreign anomalies to 0 and cap the no_tourist_stay to no_tourist_all.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbl_tourism_wide <- tbl_tourism_wide %>%\n  mutate(revenue_foreign = if_else(revenue_foreign < 0, 0, revenue_foreign),\n         no_tourist_stay = if_else(no_tourist_stay > no_tourist_all, no_tourist_all, no_tourist_stay))\n\n# Check output\nsummary(tbl_tourism_wide)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      date            province_thai      province_eng       region_thai       \n Min.   :2019-01-01   Length:3850        Length:3850        Length:3850       \n 1st Qu.:2020-01-01   Class :character   Class :character   Class :character  \n Median :2021-01-16   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2021-01-15                                                           \n 3rd Qu.:2022-02-01                                                           \n Max.   :2023-02-01                                                           \n  region_eng        ratio_tourist_stay no_tourist_stay   no_tourist_all   \n Length:3850        Min.   : 0.00      Min.   :      0   Min.   :      0  \n Class :character   1st Qu.:20.18      1st Qu.:  16259   1st Qu.:  39092  \n Mode  :character   Median :41.81      Median :  44579   Median :  92122  \n                    Mean   :38.93      Mean   : 105134   Mean   : 206328  \n                    3rd Qu.:56.20      3rd Qu.:  90902   3rd Qu.: 203646  \n                    Max.   :95.86      Max.   :3335728   Max.   :6131044  \n no_tourist_thai   no_tourist_foreign   revenue_all         revenue_thai      \n Min.   :      0   Min.   :      0.0   Min.   :0.000e+00   Min.   :0.000e+00  \n 1st Qu.:  37169   1st Qu.:     49.2   1st Qu.:6.332e+07   1st Qu.:5.925e+07  \n Median :  88782   Median :    553.0   Median :1.955e+08   Median :1.773e+08  \n Mean   : 173962   Mean   :  32366.1   Mean   :1.344e+09   Mean   :6.636e+08  \n 3rd Qu.: 184256   3rd Qu.:   5189.5   3rd Qu.:5.060e+08   3rd Qu.:4.600e+08  \n Max.   :4087756   Max.   :2473725.0   Max.   :1.103e+11   Max.   :4.506e+10  \n revenue_foreign    \n Min.   :0.000e+00  \n 1st Qu.:1.100e+05  \n Median :1.540e+06  \n Mean   :6.802e+08  \n 3rd Qu.:1.742e+07  \n Max.   :8.503e+10  \n```\n\n\n:::\n:::\n\n\n\nTo facilitate spatial autocorrelation across space and space and time, I need the tourism data in different formats. While doing so, additional KPIs will also be calculated. Rationale for those will be further explained while exploring the data.\n\n::: panel-tabset\n# Overall\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summarize across all years\ntbl_tourism_sum_all <- tbl_tourism_wide %>%\n  group_by(province_eng, province_thai, region_thai, region_eng) %>%\n  summarize(\n    ratio_tourist_stay = mean(ratio_tourist_stay, na.rm = TRUE),\n    no_tourist_stay = sum(no_tourist_stay, na.rm = TRUE),\n    no_tourist_all = sum(no_tourist_all, na.rm = TRUE),\n    no_tourist_thai = sum(no_tourist_thai, na.rm = TRUE),\n    no_tourist_foreign = sum(no_tourist_foreign, na.rm = TRUE),\n    revenue_all = sum(revenue_all, na.rm = TRUE),\n    revenue_thai = sum(revenue_thai, na.rm = TRUE),\n    revenue_foreign = sum(revenue_foreign, na.rm = TRUE)\n  ) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'province_eng', 'province_thai',\n'region_thai'. You can override using the `.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute additional KPIs\ntbl_tourism_sum_all <- tbl_tourism_sum_all %>%\n  mutate(tourist_thai_prop = ifelse(no_tourist_all == 0, 0, no_tourist_thai/no_tourist_all),\n         tourist_foreign_prop = ifelse(no_tourist_all == 0, 0, no_tourist_foreign/no_tourist_all),\n         revenue_thai_prop = ifelse(revenue_all == 0, 0, revenue_thai/revenue_all),\n         revenue_foreign_prop = ifelse(revenue_all == 0, 0, revenue_foreign/revenue_all),\n         revenue_tourist_all = ifelse(no_tourist_all == 0, 0, revenue_all/no_tourist_all),\n         revenue_tourist_thai = ifelse(no_tourist_thai == 0, 0, revenue_thai/no_tourist_thai),\n         revenue_tourist_foreign = ifelse(no_tourist_foreign == 0, 0, revenue_foreign/no_tourist_foreign),\n         revenue_tourist_stay = ifelse(no_tourist_stay == 0, 0, revenue_all/no_tourist_stay),\n         tourist_stay_all = ifelse(no_tourist_all == 0, 0, no_tourist_stay/no_tourist_all))\n\n# Check output\nsummary(tbl_tourism_sum_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n province_eng       province_thai      region_thai         region_eng       \n Length:77          Length:77          Length:77          Length:77         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n ratio_tourist_stay no_tourist_stay    no_tourist_all      no_tourist_thai    \n Min.   :28.25      Min.   :  259406   Min.   :   772281   Min.   :   750474  \n 1st Qu.:35.02      1st Qu.: 1240268   1st Qu.:  3155560   1st Qu.:  2943753  \n Median :38.76      Median : 2520445   Median :  5474592   Median :  4583102  \n Mean   :38.93      Mean   : 5256719   Mean   : 10316425   Mean   :  8698118  \n 3rd Qu.:42.78      3rd Qu.: 4580731   3rd Qu.: 10819668   3rd Qu.:  9615273  \n Max.   :52.22      Max.   :75436842   Max.   :151352500   Max.   :106899866  \n no_tourist_foreign  revenue_all         revenue_thai       revenue_foreign    \n Min.   :    3771   Min.   :8.961e+08   Min.   :8.918e+08   Min.   :4.300e+06  \n 1st Qu.:   37764   1st Qu.:5.416e+09   1st Qu.:4.860e+09   1st Qu.:7.466e+07  \n Median :  127404   Median :1.330e+10   Median :1.179e+10   Median :3.856e+08  \n Mean   : 1618306   Mean   :6.719e+10   Mean   :3.318e+10   Mean   :3.401e+10  \n 3rd Qu.:  653537   3rd Qu.:2.306e+10   3rd Qu.:2.188e+10   3rd Qu.:2.242e+09  \n Max.   :44452634   Max.   :1.847e+12   Max.   :7.407e+11   Max.   :1.106e+12  \n tourist_thai_prop tourist_foreign_prop revenue_thai_prop revenue_foreign_prop\n Min.   :0.3543    Min.   :0.002864     Min.   :0.1194    Min.   :0.003415    \n 1st Qu.:0.9320    1st Qu.:0.011023     1st Qu.:0.8835    1st Qu.:0.013795    \n Median :0.9789    Median :0.021105     Median :0.9648    Median :0.035169    \n Mean   :0.9158    Mean   :0.084222     Mean   :0.8766    Mean   :0.123400    \n 3rd Qu.:0.9890    3rd Qu.:0.068013     3rd Qu.:0.9862    3rd Qu.:0.116452    \n Max.   :0.9971    Max.   :0.645727     Max.   :0.9966    Max.   :0.880606    \n revenue_tourist_all revenue_tourist_thai revenue_tourist_foreign\n Min.   :  907.7     Min.   :  906.8      Min.   : 1068          \n 1st Qu.: 1500.3     1st Qu.: 1499.0      1st Qu.: 2092          \n Median : 1990.7     Median : 1969.7      Median : 2876          \n Mean   : 3454.3     Mean   : 2805.1      Mean   : 5212          \n 3rd Qu.: 3325.0     3rd Qu.: 3085.8      3rd Qu.: 4743          \n Max.   :30610.0     Max.   :13343.8      Max.   :41744          \n revenue_tourist_stay tourist_stay_all\n Min.   : 2394        Min.   :0.0885  \n 1st Qu.: 3843        1st Qu.:0.3102  \n Median : 4672        Median :0.4984  \n Mean   : 6765        Mean   :0.4983  \n 3rd Qu.: 7129        3rd Qu.:0.6360  \n Max.   :34955        Max.   :0.9044  \n```\n\n\n:::\n:::\n\n\n\n# By Year\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summarize across all years\ntbl_tourism_sum_year <- tbl_tourism_wide %>%\n  mutate(year = year(date)) %>%\n  group_by(year, province_eng, province_thai, region_thai, region_eng) %>%\n  summarize(\n    ratio_tourist_stay = mean(ratio_tourist_stay, na.rm = TRUE),\n    no_tourist_stay = sum(no_tourist_stay, na.rm = TRUE),\n    no_tourist_all = sum(no_tourist_all, na.rm = TRUE),\n    no_tourist_thai = sum(no_tourist_thai, na.rm = TRUE),\n    no_tourist_foreign = sum(no_tourist_foreign, na.rm = TRUE),\n    revenue_all = sum(revenue_all, na.rm = TRUE),\n    revenue_thai = sum(revenue_thai, na.rm = TRUE),\n    revenue_foreign = sum(revenue_foreign, na.rm = TRUE)\n  ) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'year', 'province_eng', 'province_thai',\n'region_thai'. You can override using the `.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute additional KPIs\ntbl_tourism_sum_year <- tbl_tourism_sum_year %>%\n  mutate(tourist_thai_prop = ifelse(no_tourist_all == 0, 0, no_tourist_thai/no_tourist_all),\n         tourist_foreign_prop = ifelse(no_tourist_all == 0, 0, no_tourist_foreign/no_tourist_all),\n         revenue_thai_prop = ifelse(revenue_all == 0, 0, revenue_thai/revenue_all),\n         revenue_foreign_prop = ifelse(revenue_all == 0, 0, revenue_foreign/revenue_all),\n         revenue_tourist_all = ifelse(no_tourist_all == 0, 0, revenue_all/no_tourist_all),\n         revenue_tourist_thai = ifelse(no_tourist_thai == 0, 0, revenue_thai/no_tourist_thai),\n         revenue_tourist_foreign = ifelse(no_tourist_foreign == 0, 0, revenue_foreign/no_tourist_foreign),\n         revenue_tourist_stay = ifelse(no_tourist_stay == 0, 0, revenue_all/no_tourist_stay),\n         tourist_stay_all = ifelse(no_tourist_all == 0, 0, no_tourist_stay/no_tourist_all))\n\n# Check output\nsummary(tbl_tourism_sum_year)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      year      province_eng       province_thai      region_thai       \n Min.   :2019   Length:385         Length:385         Length:385        \n 1st Qu.:2020   Class :character   Class :character   Class :character  \n Median :2021   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2021                                                           \n 3rd Qu.:2022                                                           \n Max.   :2023                                                           \n  region_eng        ratio_tourist_stay no_tourist_stay    no_tourist_all    \n Length:385         Min.   : 5.452     Min.   :   13523   Min.   :   45008  \n Class :character   1st Qu.:25.977     1st Qu.:  176772   1st Qu.:  425219  \n Mode  :character   Median :42.385     Median :  400926   Median :  889499  \n                    Mean   :42.228     Mean   : 1051344   Mean   : 2063285  \n                    3rd Qu.:57.638     3rd Qu.:  933078   3rd Qu.: 2072363  \n                    Max.   :92.170     Max.   :36407624   Max.   :66966562  \n no_tourist_thai    no_tourist_foreign  revenue_all         revenue_thai      \n Min.   :   44180   Min.   :       0   Min.   :4.204e+07   Min.   :4.165e+07  \n 1st Qu.:  387805   1st Qu.:    2221   1st Qu.:7.809e+08   1st Qu.:7.160e+08  \n Median :  852972   Median :   11860   Median :1.873e+09   Median :1.746e+09  \n Mean   : 1739624   Mean   :  323661   Mean   :1.344e+10   Mean   :6.636e+09  \n 3rd Qu.: 1799767   3rd Qu.:   79008   3rd Qu.:5.134e+09   3rd Qu.:4.647e+09  \n Max.   :42073847   Max.   :24892715   Max.   :1.068e+12   Max.   :3.846e+11  \n revenue_foreign     tourist_thai_prop tourist_foreign_prop revenue_thai_prop\n Min.   :0.000e+00   Min.   :0.2104    Min.   :0.000000     Min.   :0.05123  \n 1st Qu.:4.880e+06   1st Qu.:0.9468    1st Qu.:0.004155     1st Qu.:0.92557  \n Median :3.119e+07   Median :0.9875    Median :0.012525     Median :0.98198  \n Mean   :6.802e+09   Mean   :0.9315    Mean   :0.068537     Mean   :0.90492  \n 3rd Qu.:2.702e+08   3rd Qu.:0.9958    3rd Qu.:0.053158     3rd Qu.:0.99451  \n Max.   :6.832e+11   Max.   :1.0000    Max.   :0.789559     Max.   :1.00000  \n revenue_foreign_prop revenue_tourist_all revenue_tourist_thai\n Min.   :0.000000     Min.   :  695.6     Min.   :  695.2     \n 1st Qu.:0.005495     1st Qu.: 1394.0     1st Qu.: 1382.6     \n Median :0.018025     Median : 1983.6     Median : 1937.6     \n Mean   :0.095078     Mean   : 3207.1     Mean   : 2690.1     \n 3rd Qu.:0.074430     3rd Qu.: 3185.7     3rd Qu.: 3113.0     \n Max.   :0.948773     Max.   :36131.4     Max.   :15683.4     \n revenue_tourist_foreign revenue_tourist_stay tourist_stay_all \n Min.   :    0           Min.   : 2030        Min.   :0.05899  \n 1st Qu.: 1931           1st Qu.: 3557        1st Qu.:0.33405  \n Median : 2657           Median : 4743        Median :0.48410  \n Mean   : 4603           Mean   : 6427        Mean   :0.49282  \n 3rd Qu.: 4373           3rd Qu.: 7059        3rd Qu.:0.61740  \n Max.   :58147           Max.   :44768        Max.   :0.95484  \n```\n\n\n:::\n:::\n\n\n\n# By Year & Month\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# No additional processing required\n# Compute additional KPIs\ntbl_tourism_wide <- tbl_tourism_wide %>%\n  mutate(tourist_thai_prop = ifelse(no_tourist_all == 0, 0, no_tourist_thai/no_tourist_all),\n         tourist_foreign_prop = ifelse(no_tourist_all == 0, 0, no_tourist_foreign/no_tourist_all),\n         revenue_thai_prop = ifelse(revenue_all == 0, 0, revenue_thai/revenue_all),\n         revenue_foreign_prop = ifelse(revenue_all == 0, 0, revenue_foreign/revenue_all),\n         revenue_tourist_all = ifelse(no_tourist_all == 0, 0, revenue_all/no_tourist_all),\n         revenue_tourist_thai = ifelse(no_tourist_thai == 0, 0, revenue_thai/no_tourist_thai),\n         revenue_tourist_foreign = ifelse(no_tourist_foreign == 0, 0, revenue_foreign/no_tourist_foreign),\n         revenue_tourist_stay = ifelse(no_tourist_stay == 0, 0, revenue_all/no_tourist_stay),\n         tourist_stay_all = ifelse(no_tourist_all == 0, 0, no_tourist_stay/no_tourist_all))\n\n# Check output\nsummary(tbl_tourism_wide)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      date            province_thai      province_eng       region_thai       \n Min.   :2019-01-01   Length:3850        Length:3850        Length:3850       \n 1st Qu.:2020-01-01   Class :character   Class :character   Class :character  \n Median :2021-01-16   Mode  :character   Mode  :character   Mode  :character  \n Mean   :2021-01-15                                                           \n 3rd Qu.:2022-02-01                                                           \n Max.   :2023-02-01                                                           \n  region_eng        ratio_tourist_stay no_tourist_stay   no_tourist_all   \n Length:3850        Min.   : 0.00      Min.   :      0   Min.   :      0  \n Class :character   1st Qu.:20.18      1st Qu.:  16259   1st Qu.:  39092  \n Mode  :character   Median :41.81      Median :  44579   Median :  92122  \n                    Mean   :38.93      Mean   : 105134   Mean   : 206328  \n                    3rd Qu.:56.20      3rd Qu.:  90902   3rd Qu.: 203646  \n                    Max.   :95.86      Max.   :3335728   Max.   :6131044  \n no_tourist_thai   no_tourist_foreign   revenue_all         revenue_thai      \n Min.   :      0   Min.   :      0.0   Min.   :0.000e+00   Min.   :0.000e+00  \n 1st Qu.:  37169   1st Qu.:     49.2   1st Qu.:6.332e+07   1st Qu.:5.925e+07  \n Median :  88782   Median :    553.0   Median :1.955e+08   Median :1.773e+08  \n Mean   : 173962   Mean   :  32366.1   Mean   :1.344e+09   Mean   :6.636e+08  \n 3rd Qu.: 184256   3rd Qu.:   5189.5   3rd Qu.:5.060e+08   3rd Qu.:4.600e+08  \n Max.   :4087756   Max.   :2473725.0   Max.   :1.103e+11   Max.   :4.506e+10  \n revenue_foreign     tourist_thai_prop tourist_foreign_prop revenue_thai_prop\n Min.   :0.000e+00   Min.   :0.0000    Min.   :0.0000000    Min.   :0.0000   \n 1st Qu.:1.100e+05   1st Qu.:0.9627    1st Qu.:0.0008535    1st Qu.:0.9511   \n Median :1.540e+06   Median :0.9932    Median :0.0066240    Median :0.9911   \n Mean   :6.802e+08   Mean   :0.9297    Mean   :0.0637772    Mean   :0.9090   \n 3rd Qu.:1.742e+07   3rd Qu.:0.9990    3rd Qu.:0.0346323    3rd Qu.:0.9988   \n Max.   :8.503e+10   Max.   :1.0000    Max.   :1.0000000    Max.   :1.0016   \n revenue_foreign_prop revenue_tourist_all revenue_tourist_thai\n Min.   :0.000000     Min.   :     0      Min.   :    0       \n 1st Qu.:0.001126     1st Qu.:  1366      1st Qu.: 1345       \n Median :0.008700     Median :  1932      Median : 1880       \n Mean   :0.084802     Mean   :  3513      Mean   : 2614       \n 3rd Qu.:0.045997     3rd Qu.:  3199      3rd Qu.: 3082       \n Max.   :1.000000     Max.   :300000      Max.   :17325       \n revenue_tourist_foreign revenue_tourist_stay tourist_stay_all\n Min.   :    0           Min.   :     0       Min.   :0.0000  \n 1st Qu.: 1294           1st Qu.:  3187       1st Qu.:0.3543  \n Median : 2372           Median :  4448       Median :0.5128  \n Mean   : 4504           Mean   :  6428       Mean   :0.5270  \n 3rd Qu.: 4137           3rd Qu.:  6754       3rd Qu.:0.6981  \n Max.   :65000           Max.   :300000       Max.   :1.0000  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save processed tbl_tourism_wide\nwrite_rds(tbl_tourism_wide, 'data/processed/tbl_tourism_wide.rds')\n```\n:::\n\n\n:::\n\n### 1.2.3 Merge Tourism data\n\nFinally, I can merge the tourism dataset to the spatial dataset using `left_join` from dplyr. These are sorted to facilitate filtering later.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join with tourism data all\nth_bound_tour_all <- left_join(th_bound_l1, tbl_tourism_sum_all, by = c(\"ADM1_EN\" = \"province_eng\")) %>%\n  arrange(ADM1_EN)\n\n# Join with tourism data by year\nth_bound_tour_year <- left_join(th_bound_l1, tbl_tourism_sum_year, by = c(\"ADM1_EN\" = \"province_eng\")) %>%\n  arrange(year, ADM1_EN)\n\n\n# Join with tourism data by year and month\nth_bound_tour_year_month <- left_join(th_bound_l1, tbl_tourism_wide, by = c(\"ADM1_EN\" = \"province_eng\")) %>%\n  arrange(date.y, ADM1_EN)\n```\n:::\n\n\n\nA good practise is to save these processed datasets for easy retrieval.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Export to processed sub-folder as RDS\nwrite_rds(th_bound_tour_all, 'data/processed/th_bound_tour_all.rds')\n\nwrite_rds(th_bound_tour_year, 'data/processed/th_bound_tour_year.rds')\n\nwrite_rds(th_bound_tour_year_month, 'data/processed/th_bound_tour_year_month.rds')\n```\n:::\n\n\n\nAfter clearing the r environment, I'll load in the various datasets.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clear R console\nrm(list = ls(all.names = TRUE))\n\n# Load various processed dataset\nth_bound_tour_all <- read_rds('data/processed/th_bound_tour_all.rds')\nth_bound_tour_year <- read_rds('data/processed/th_bound_tour_year.rds')\nth_bound_tour_year_month <- read_rds('data/processed/th_bound_tour_year_month.rds')\n```\n:::\n\n\n\n# 2 Exploratory Data Analysis\n\nIn this section, I will explore the various tourism indicators provided by the dataset.\n\n| Variable           | Definition                                                        |\n|-------------------------|-----------------------------------------------|\n| revenue_all        | Revenue generated by all tourists in the province (Thai Baht)     |\n| revenue_thai       | Revenue generated by Thai tourists in the province (Thai Baht)    |\n| revenue_foreign    | Revenue generated by Foreign tourists in the province (Thai Baht) |\n| no_tourist_all     | Total number of tourists who visited the province                 |\n| no_tourist_thai    | Number of Thai tourists who visited the province                  |\n| no_tourist_foreign | Number of Foreign tourists who visited the province               |\n| ratio_tourist_stay | Occupancy rate - Percentage of occupied travel accomodation       |\n| no_tourist_stay    | Number of Tourists who stayed overnight in the province           |\n\nLets first check the revenue indicators.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for revenue\nrevenue_all <- ggplot(data=th_bound_tour_all, \n                      aes(x=`revenue_all`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Revenue from all tourists\")\n\nrevenue_thai <- ggplot(data=th_bound_tour_all, \n                      aes(x=`revenue_thai`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Revenue from Thai tourists\")\n\nrevenue_foreign <- ggplot(data=th_bound_tour_all, \n                      aes(x=`revenue_foreign`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Revenue from Foreign tourists\")\n\nggarrange(revenue_all, revenue_thai, revenue_foreign, ncol = 3)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\nAs expected, there is a large left skew, with majority of provinces generating much lesser revenue as compared to the outliers. Lets look at the tourist count then.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for tourist\nmap1 <- ggplot(data=th_bound_tour_all, \n                      aes(x=`no_tourist_all`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Total Number of tourists\")\n\nmap2 <- ggplot(data=th_bound_tour_all, \n                      aes(x=`no_tourist_thai`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Number of Thai tourists\")\n\nmap3 <- ggplot(data=th_bound_tour_all, \n                      aes(x=`no_tourist_foreign`)) +\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") + \n  labs(x = \"Number of Foreign tourists\")\n\nggarrange(map1, map2, map3, ncol = 3)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\nAgain, we see the same distribution for tourist count as compared to revenue. This is can be clearly illustrated when we plot both revenue and tourists as choropleth maps.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap1 <- tm_shape(th_bound_tour_all) + \n  tm_fill(col = \"no_tourist_all\",\n          n = 5,\n          style = \"jenks\", \n          title = \"Total Tourist\") + \n  tm_borders(alpha = 0.5) \n\nmap2 <- tm_shape(th_bound_tour_all) + \n  tm_fill(col = \"revenue_all\",\n          n = 5,\n          style = \"jenks\",\n          title = \"Total Revenue\") + \n  tm_borders(alpha = 0.5) \n\ntmap_arrange(map1, map2,\n             asp=NA, ncol=2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-19-1.png){width=1152}\n:::\n:::\n\n\n\nIt is clear that provinces with larger volume of tourists will generate larger revenue. However, that is not necessarily a good indicator of the tourism economy. Other than just trying to increase revenue by increasing the tourist traffic, the Thai government will also be keen into other indicators.\n\n## 2.1 Feature Engineering\n\nOther variables are created in order to provide greater depth to analysing the Thai tourism economy.\n\n| Variable                | Definition                                          |\n|-------------------------|-----------------------------------------------|\n| tourist_thai_prop       | Proportion of tourists who are Thai                 |\n| tourist_foreign_prop    | Proportion of tourists who are Foreign              |\n| revenue_thai_prop       | Proportion of revenue generated by Thai tourists    |\n| revenue_foreign_prop    | Proportion of revenue generated by Foreign tourists |\n| revenue_tourist_all     | Revenue generated per tourist                       |\n| revenue_tourist_thai    | Revenue generated per Thai tourist                  |\n| revenue_tourist_foreign | Revenue generated per Foreign tourist               |\n| revenue_tourist_stay    | Revenue generated per tourist who stay overnight    |\n| tourist_stay_all        | Proportion of tourists who stayed overnight         |\n\nHere's a quick check for 1 of the\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize revenue per tourist\ntm_shape(th_bound_tour_all) + \n  tm_fill(col = \"revenue_tourist_all\",\n          n = 5,\n          style = \"jenks\", \n          title = \"Revenue per Tourist\") + \n  tm_borders(alpha = 0.5) \n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-20-1.png){width=1152}\n:::\n:::\n\n\n\nThis clearly shows a different distribution compared to the basic revenue/tourist count distribution. This indicator is also important the Thai government can try to increase total tourism revenue by increasing per Thai Baht spent by each tourist.\n\n## 2.2 Power BI Visualization\n\nPress play to see how the values change across time!\n\n::: {style=\"position: relative; width: 100%; height: 0; padding-bottom: 56.25%;\"}\n<iframe title=\"Geospatial TakeHome Ex01\" src=\"https://app.powerbi.com/view?r=eyJrIjoiYzQ3MTQzY2ItNjMyZi00ZWIwLTliYTUtOGQwM2JhNWM3OTVhIiwidCI6ImRmNGU4MzA3LWRjNjQtNDcyYS1iNGI1LWE2ZGQ2YmExMTU2NiIsImMiOjEwfQ%3D%3D\" frameborder=\"0\" allowFullScreen=\"true\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\">\n\n</iframe>\n:::\n\nAlthought Bangkok accounts for the overwhelming proportion of revenue and tourist count, other provinces can also be viewed to be important to Thailand's tourism economy. Some provinces are largely skewed towards foreign tourists (i.e Bangkok Metropolitan Region, provinces surrounding Phuket such as Phang Nga and Surat Thani)\n\nIn terms of spending per tourist, less prominent provinces (i.e Songkhla) may place within the top provinces, showing the potential for larger provinces to improve their tourist offerings.\n\nFinally, by comparing the tourist proportion (foreign vs Thai) against proportion of tourists who stay over, it can be interesting to note the different tourism dynamics for each province.\n\n-   Phuket - revenue largely driven by foreign tourists (88%), high proportion of tourists who stay over (65%)\n-   Phang Nga - province near Phuket (revenue also driven by foreign tourists 80%) but low proportion of tourists who stay over (29%), suggesting it is a stopover visit as foreign tourists center their travel plans around Phuket instead\n-   Bangkok - revenue somewhat driven by Foreign tourists (60%), with only 50% of tourists who stay over, suggesting it is a place where people travel to as a quick getaway (usually a daytrip)\n-   Ma Hong Son - revenue largely driven by Thai tourists (78%), high proportion of tourists who stay over (90%), suggesting that it is a place where locals go to for an extended holiday given its location (at the edges of Thailand).\n\n# 3 Global Spatial Autocorrelation Analysis of Thailand Tourism Key Indicators\n\nIn order to determine whether tourism indicators are independent of space, and space and time, I would need to do the following:\n\n1.  Compute Spatial Weights\n    a.  Get list of neighbours\n    b.  Calculate weights\n2.  Perform Global Moran's I on key indicators\n\nGeary's C will not be conducted as it heavily overlaps with Moran's I (in terms of the objective).\n\n## 3.1 Spatial Weights Matrix\n\nThere are a few options to get the list of neighbours in `sfdep` package:\n\n| Method                          | Details                                                                      |\n|-------------------------|-----------------------------------------------|\n| `st_contiguity` (i.e. Queen)    | Based on regions with contiguous boundaries (uses `spdep::poly2nb`)          |\n| `st_dist_band` (fixed distance) | Based on distance band (uses `spdep::dnearneigh`)                            |\n| `st_knn` (adaptive distance)    | Based on k nearest neighbours (uses `spdep::knearneigh` and `spdep::knn2nb`) |\n\nBefore passing the coordinates to either functions, checks are required to ensure that the points are in the interior of each province (i.e. not in the middle of the ocean).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate coordinates using st_centroid\nlongitude_cent <- map_dbl(th_bound_tour_all$geometry, ~st_centroid(.x)[[1]])\nlatitude_cent <- map_dbl(th_bound_tour_all$geometry, ~st_centroid(.x)[[2]])\ncoords_cent <- cbind(longitude_cent, latitude_cent)\n\n# Generate coordinates using st_point_on_surface\nlongitude <- map_dbl(th_bound_tour_all$geometry, ~st_point_on_surface(.x)[[1]])\nlatitude <- map_dbl(th_bound_tour_all$geometry, ~st_point_on_surface(.x)[[2]])\ncoords <- cbind(longitude, latitude)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualise both points on a map to verify\nplot(th_bound_tour_all$geometry, border=\"lightgrey\", main = \"Points Comparison\")\npoints(coords_cent, pch = 19, cex = 0.2, col = \"red\")\npoints(coords, pch = 19, cex = 0.2, col = \"blue\")\nlegend(\"topright\", legend = c(\"st_centroid\", \"st_point_on_surface-\"), \n       col = c(\"red\", \"blue\"), pch = 19, cex = 0.8)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-22-1.png){width=1152}\n:::\n:::\n\n\n\nAfter closely viewing the plot, all points from `st_centroid` are within the interior of the province polygons. With the exception of a few provinces, the points from `st_centroid` are seemingly better placed towards the center as compared to `st_point_on_surface`. Therefore, this allows the sfdep distance based neighbour functions to be used with ease considering st_centroid is used as the default.\n\n::: panel-tabset\n# st_contiguity\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate neighbours\nnb_contiguity <- st_contiguity(th_bound_tour_all$geometry)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(nb_contiguity, 'data/output/nb_contiguity.rds') # Uncomment when running again\n\n# Read in output object\nnb_contiguity <- read_rds('data/output/nb_contiguity.rds')\n\n# Check output\nnb_contiguity\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 352 \nPercentage nonzero weights: 5.93692 \nAverage number of links: 4.571429 \n1 region with no links:\n48\n2 disjoint connected subgraphs\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize neighbours\nplot(th_bound_tour_all$geometry, border=\"lightgrey\", , main=\"Queen Contiguity \")\nplot(nb_contiguity, coords_cent, pch = 19, cex = 0.6, add = TRUE, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-25-1.png){width=1152}\n:::\n:::\n\n\n\n# st_dist_band\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate neighbours\nnb_dist <- st_dist_band(th_bound_tour_all$geometry)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(nb_dist, 'data/output/nb_dist.rds') # Uncomment when running again\n\n# Read in output object\nnb_dist <- read_rds('data/output/nb_dist.rds')\n\n# Check output\nnb_dist\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 474 \nPercentage nonzero weights: 7.994603 \nAverage number of links: 6.155844 \n2 disjoint connected subgraphs\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize neighbours\nplot(th_bound_tour_all$geometry, border=\"lightgrey\", main=\"Distance Band\")\nplot(nb_dist, coords_cent, pch = 19, cex = 0.6, add = TRUE, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-28-1.png){width=1152}\n:::\n:::\n\n\n\n# st_knn\n\nGeneral rule of thumb for k is square root of observations. $$\nk \\approx \\sqrt{76} \\approx 8\n$$ Just for variety, k = 5 (average number from `st_contiguity`) is also run.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate neighbours\nnb_knn_8 <- st_knn(th_bound_tour_all$geometry, k = 8)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Polygon provided. Using point on surface.\n```\n\n\n:::\n\n```{.r .cell-code}\nnb_knn_5 <- st_knn(th_bound_tour_all$geometry, k = 5)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n! Polygon provided. Using point on surface.\n```\n\n\n:::\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # # Export output object and read it in to minimize rendering time\n# write_rds(nb_knn_8, 'data/output/nb_knn_8.rds') # Uncomment when running again\n# write_rds(nb_knn_5, 'data/output/nb_knn_5.rds') # Uncomment when running again\n\n# Read in output object\nnb_knn_8 <- read_rds('data/output/nb_knn_8.rds')\nnb_knn_5 <- read_rds('data/output/nb_knn_5.rds')\n\n# Check output\nnb_knn_8\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 616 \nPercentage nonzero weights: 10.38961 \nAverage number of links: 8 \nNon-symmetric neighbours list\n```\n\n\n:::\n\n```{.r .cell-code}\nnb_knn_5\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNeighbour list object:\nNumber of regions: 77 \nNumber of nonzero links: 385 \nPercentage nonzero weights: 6.493506 \nAverage number of links: 5 \nNon-symmetric neighbours list\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize neighbours\npar(mfrow=c(1,2))\nplot(th_bound_tour_all$geometry, border=\"lightgrey\", main=\"K = 8\")\nplot(nb_knn_8, coords_cent, pch = 19, cex = 0.6, add = TRUE, col = \"red\")\nplot(th_bound_tour_all$geometry, border=\"lightgrey\", main=\"K = 5\")\nplot(nb_knn_5, coords_cent, pch = 19, cex = 0.6, add = TRUE, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-31-1.png){width=1152}\n:::\n:::\n\n\n:::\n\nComparing the various neighbour methods, I have decided on the adaptive method of determining neighbours, specifically k = 5. Reason are as follows:\n\n-   `st_contiguity` - Not appropriate for this case since not all boundaries are contiguous, (i.e. there is an island - Phuket).\n-   `st_dist_band` - Having a fixed distance causes urban provinces to have much more neighbours (i.e. Bangkok Metropolitan Region) while rural provinces have scarce neighbours. I feel that this is not an appropriate relationship for analyzing tourism indicators.\n-   `st_knn` (k = 8) - Judging from the plot, the neighbour list seemed to be much to congested. k = 5 provides a more reasonable structure.\n\nAlthough I have determined the neighbour list, there are also a few options to generate the weights:\n\n| Method                | Details                                          |\n|-----------------------|--------------------------------------------------|\n| `st_weights`          | Standardized weights based on neighbour list     |\n| `st_kernel_weights`   | Weights based on kernel functions and distance   |\n| `st_inverse_distance` | Weights based on inverse distance between points |\n\nGiven the context of tourism, I have decided to focus on `st_weights`. The rationale is as follows:\n\n-   `st_weights` - ensure that all neighbours have equal influence\n-   `st_inverse_distance` - while it can be argued that distance is likely a factor especially for specific tourism indicators (i.e. local preferring areas that are closer for a quick getaway, affecting indicators involving overnight stays), it is not clear the extent to which it impacts the overall tourism industry.\n\nWhile performing `st_weights`, the style is less significant due to the adaptive nature of KNN. W is selected as the default style. Rationale for not choosing the other styles are as follows:\n\n-   B (binary weights) - Does not really matter since neighbours are already treated uniformly\n-   C (globally standardized weights) - Will dilute local effects making it not suitable for tourism analysis\n-   U (equal weights) - Similar to C, less focused on local effects required for tourism analysis\n-   S (variance-stabilizing) - More relevant for analysis where variance stability is important\n-   minmax - Similar to C and U with added layer of normalization\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nth_tour_knn5_all <- th_bound_tour_all %>%\n  mutate(nb = nb_knn_5,\n         wt = st_weights(nb, style = \"W\"),\n         .before = 1)\n```\n:::\n\n\n\n## 3.2 Global Moran’s I across Space\n\nIn performing Global Moran's I, `global_moran_perm` will be used over `global_moran` and `global_moran_test` as:\n\n-   `global_moran` does not give any p-value\n-   `global_moran_test` is not as robust as `global_moran_perm` which is a Monte-Carlo simulation.\n\nThe null and alternative hypothesis for Global Moran's I are:\n\nH0: The attribute is randomly distributed among the provinces, no spatial autocorrelation\n\nH1: The attribute is not randomly distributed among the provinces, spatial autocorrelation\n\n::: panel-tabset\n# Revenue\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_all,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.021003, observed rank = 848, p-value = 0.304\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_thai,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = -0.0019269, observed rank = 694, p-value = 0.612\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_foreign,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.035698, observed rank = 897, p-value = 0.206\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_thai_prop,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.36446, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_foreign_prop,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.36446, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\n# Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$no_tourist_all,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.025892, observed rank = 848, p-value = 0.304\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$no_tourist_thai,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.029083, observed rank = 829, p-value = 0.342\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$no_tourist_foreign,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.059863, observed rank = 926, p-value = 0.148\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$tourist_thai_prop,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.39259, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$tourist_foreign_prop,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.39259, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\n# Revenue/Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_tourist_all,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.35986, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_tourist_thai,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.38688, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_tourist_foreign,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.2972, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\n# Occupancy Rate\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$ratio_tourist_stay,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.087707, observed rank = 931, p-value = 0.138\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n\n# Overnight Guest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$no_tourist_stay,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.027289, observed rank = 828, p-value = 0.344\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$tourist_stay_all,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.35405, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(42)\nglobal_moran_perm(th_tour_knn5_all$revenue_tourist_stay,\n                  th_tour_knn5_all$nb,\n                  th_tour_knn5_all$wt,\n                  nsim = 999)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 1000 \n\nstatistic = 0.35298, observed rank = 1000, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n:::\n\n\n:::\n\nThe p-value of Moran's I test for basic attributes are \\>0.05, therefore I am not able to reject the null hypothesis for those attributes.\n\nHowever, for the engineered features, the p-value is \\<0.05, allowing me to reject the null hypothesis and conclude that there is sufficient evidence for the alternative hypothesis that there is spatial autocorrelation.\n\nTherefore, with those indicators in mind I can conclude that Thailand's tourism economy is spatial dependent.\n\n## 3.3 Global Moran's I across Space and Time\n\nTo determine whether the tourism indicators are independent of space and time, I will do the following:\n\n1.  Set seed\n2.  Filter the respective datasets by specific time (Year/Year and month)\n3.  Append the neighbour list created in 3.1\n4.  Calculate the spatial weight matrix\n5.  Perform Global Moran's I for all KPIs\n6.  Consolidate the results of the Global Moran's I\n\nSince this is very repetitive, I'll use a function to run this iteratively.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to run global_moran_perm iteratively\nrun_global_moran <- function(data, date_col, value, kpi_list) {\n  # Set seed\n  set.seed(42)\n\n  # Filter sf dataframe\n  filtered_data <- data %>%\n    filter(!!sym(date_col) == value)\n  \n  # Append neighbour list and calculate spatial weight matrix\n  filtered_data <- filtered_data %>%\n    mutate(nb = nb_knn_5,\n           wt = st_weights(nb, style = \"W\"),\n           .before = 1)\n  \n  # Run global_moran_perm for each KPI in kpi_weight list\n  results <- lapply(kpi_list, function(kpi) {\n    moran_output <- global_moran_perm(filtered_data[[kpi]],\n                                      filtered_data$nb,\n                                      filtered_data$wt,\n                                      nsim = 999)\n    data.frame(\n      kpi = kpi,\n      statistic = mean(moran_output$res),\n      p_value = moran_output$p.value\n      )\n  })\n  \n  \n  # Combine both results\n  results_df <- bind_rows(results)\n  \n  results_df <- results_df %>%\n    mutate(date = value,\n           .before = 1)\n  rownames(results_df) <- NULL\n  return(results_df)\n}\n```\n:::\n\n\n\n### 3.3.1 Across Year\n\nOn top of running the function a few additional steps are required:\n\n1.  Define kpi list\n2.  Define list of date to iterate\n3.  Consolidate output\n\nThe output is also processed in a way that only replaces statistic values for those that are not significant (p_value \\> 0.05), and pivot to a format for ease of visualization in a table.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of KPIs\nkpi_list <- c(\n  \"revenue_all\", \"revenue_thai\", \"revenue_foreign\", \"revenue_thai_prop\", \"revenue_foreign_prop\",\n  \"no_tourist_all\", \"no_tourist_thai\", \"no_tourist_foreign\", \"tourist_thai_prop\", \"tourist_foreign_prop\",\n  \"revenue_tourist_all\", \"revenue_tourist_thai\", \"revenue_tourist_foreign\", \n  \"ratio_tourist_stay\", \"no_tourist_stay\", \"revenue_tourist_stay\", \"tourist_stay_all\" \n)\n\n# List of years to iterate\nyear_list <- unique(th_bound_tour_year$year)\n\n# Create output list\nall_results <- list()\n\nfor (year_val in year_list) {\n  # Run function for each year\n  result <- run_global_moran(th_bound_tour_year, \"year\", year_val, kpi_list)\n  \n  # Append results to list\n  all_results[[as.character(year_val)]] <- result\n}\n\n# Combine all output\nglobal_moran_year <- bind_rows(all_results)\n\n# Process output\nglobal_moran_year <- global_moran_year %>%\n  mutate(statistic = ifelse(p_value <= 0.05, round(statistic,3), \"-\")) %>%\n  select(date, kpi, statistic) %>%\n  pivot_wider(names_from = date, values_from = statistic)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(global_moran_year, 'data/output/global_moran_year.rds') # Uncomment when running the Global Moran's I again\n\n# Read in output object\nglobal_moran_year <- read_rds('data/output/global_moran_year.rds')\n```\n:::\n\n\n\nNow that the data is properly formatted, we can view the table with `datatable` from `DT` package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# datatable(global_moran_year, rownames=FALSE, extensions=\"Scroller\", class=\"display\", width=\"100%\",\n#             options=list(initComplete = JS(\n#     \"function(settings, json) {\",\n#     \"$('body').css({'font-family': 'sans-serif'});\",\n#     \"}\"\n#   ), deferRender=TRUE, scrollY=300, scroller=TRUE))\n\ndatatable(global_moran_year, rownames=FALSE, width=\"100%\",\n            options=list(pageLength = 17, initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-059f71f8b703a89bfe11\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-059f71f8b703a89bfe11\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\"],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-0.015\",\"-0.012\",\"-0.014\",\"-0.013\",\"-\",\"-0.013\",\"-0.011\"],[\"-\",\"-\",\"-\",\"-0.016\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.014\",\"-0.012\",\"-0.014\",\"-0.01\",\"-\",\"-0.013\",\"-0.012\"],[\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.012\",\"-0.013\",\"-0.012\",\"-0.012\",\"-0.012\",\"-\",\"-0.013\",\"-0.011\"],[\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.015\",\"-0.01\",\"-0.013\",\"-0.013\",\"-\",\"-0.014\",\"-0.011\"],[\"-\",\"-\",\"-\",\"-0.015\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.016\",\"-0.01\",\"-\",\"-0.013\",\"-\",\"-0.013\",\"-0.011\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>kpi<\\/th>\\n      <th>2019<\\/th>\\n      <th>2020<\\/th>\\n      <th>2021<\\/th>\\n      <th>2022<\\/th>\\n      <th>2023<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":17,\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"name\":\"kpi\",\"targets\":0},{\"name\":\"2019\",\"targets\":1},{\"name\":\"2020\",\"targets\":2},{\"name\":\"2021\",\"targets\":3},{\"name\":\"2022\",\"targets\":4},{\"name\":\"2023\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[10,17,25,50,100]}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\nAs expected, the basic indicators do not show any statistically significant spatial autocorrelation. Nevertheless, although the engineered indicators are generally statistically significant across the years, they are negative and very close to 0. This suggests that there is an extremely weak dispersal.\n\n### 3.3.2 Across Year and Month\n\nSimiliar to the processes in 3.3.1, I will need to:\n\n1.  Define list of dates to iterate\n2.  Consolidate output\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of year and month to iterate\nyear_month_list <- unique(th_bound_tour_year_month$date.y)\n\n# Create output list\nall_results <- list()\n\nfor (year_month_val in year_month_list) {\n  # Run function for each year\n  result <- run_global_moran(th_bound_tour_year_month, \"date.y\", year_month_val, kpi_list)\n  \n  # Append results to list\n  all_results[[as.character(year_month_val)]] <- result\n}\n\n# Combine all output\nglobal_moran_year_month <- bind_rows(all_results)\n```\n:::\n\n\n\nAdditional data processing steps are required to format the data appropriately.\n\n1.  Create separate year and month columns\n2.  Replaces statistic values for those that are not significant (p_value \\> 0.05),\n3.  Pivot to a format for ease of visualization in a table.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Process output\nglobal_moran_year_month <- global_moran_year_month %>%\n  mutate(date = as.Date.numeric(date),\n         year = year(date),\n         month = format(date,\"%b\"),\n         statistic = ifelse(p_value <= 0.05, round(statistic,3), \"-\")) %>%\n  select(year, kpi, statistic, month) %>%\n  pivot_wider(names_from = month, values_from = statistic)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(global_moran_year_month, 'data/output/global_moran_year_month.rds') # Uncomment when running the Global Moran's I again\n\n# Read in output object\nglobal_moran_year_month <- read_rds('data/output/global_moran_year_month.rds')\n```\n:::\n\n\n\n`crosstalk` package is then used to provide an interactive way of filtering the table\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshared <- SharedData$new(global_moran_year_month)\n\nbscols(widths = c(12, 12),\n  filter_select(\n  id = \"year\", label = \"Year\", \n  sharedData = shared, ~year\n  ),\n  \n  tags$div(style = 'width:100%; overflow-x: auto;', \n    \n  datatable(shared, rownames=FALSE,\n            extensions = c(\"FixedColumns\"),\n            options=list(pageLength = 17,\n                         fixedColumns = list(leftColumns = 2),\n                         initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif', 'font-size': '12px'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif', 'font-size': '12px'});\",\n    \"}\"\n    ))\n    )\n    \n    )\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"container-fluid crosstalk-bscols\">\n<div class=\"row\">\n<div class=\"col-xs-12\">\n<div id=\"year\" class=\"form-group crosstalk-input-select crosstalk-input\">\n<label class=\"control-label\" for=\"year\">Year</label>\n<div>\n<select multiple></select>\n<script type=\"application/json\" data-for=\"year\">{\n  \"items\": {\n    \"value\": [\"2019\", \"2020\", \"2021\", \"2022\", \"2023\"],\n    \"label\": [\"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n  },\n  \"map\": {\n    \"2019\": [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\"],\n    \"2020\": [\"18\", \"19\", \"20\", \"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\", \"32\", \"33\", \"34\"],\n    \"2021\": [\"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\", \"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\"],\n    \"2022\": [\"52\", \"53\", \"54\", \"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\", \"65\", \"66\", \"67\", \"68\"],\n    \"2023\": [\"69\", \"70\", \"71\", \"72\", \"73\", \"74\", \"75\", \"76\", \"77\", \"78\", \"79\", \"80\", \"81\", \"82\", \"83\", \"84\", \"85\"]\n  },\n  \"group\": [\"SharedData059f71f8\"]\n}</script>\n</div>\n</div>\n</div>\n<div class=\"col-xs-12\">\n<div style=\"width:100%; overflow-x: auto;\">\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-c23e1279e40b1cba3595\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c23e1279e40b1cba3595\">{\"x\":{\"crosstalkOptions\":{\"key\":[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\"],\"group\":\"SharedData059f71f8\"},\"filter\":\"none\",\"vertical\":false,\"extensions\":[\"FixedColumns\"],\"data\":[[2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023,2023],[\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\",\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\",\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\",\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\",\"revenue_all\",\"revenue_thai\",\"revenue_foreign\",\"revenue_thai_prop\",\"revenue_foreign_prop\",\"no_tourist_all\",\"no_tourist_thai\",\"no_tourist_foreign\",\"tourist_thai_prop\",\"tourist_foreign_prop\",\"revenue_tourist_all\",\"revenue_tourist_thai\",\"revenue_tourist_foreign\",\"ratio_tourist_stay\",\"no_tourist_stay\",\"revenue_tourist_stay\",\"tourist_stay_all\"],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.015\",\"-0.012\",\"-0.014\",\"-\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.015\",\"-0.012\",\"-0.014\",\"-\",\"-\",\"-0.012\",\"-0.011\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-0.013\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.015\",\"-\",\"-\",\"-0.015\",\"-0.013\",\"-0.011\",\"-0.014\",\"-0.011\",\"-0.012\",\"-0.013\",\"-\",\"-0.014\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.016\",\"-0.01\",\"-\",\"-0.012\",\"-\",\"-0.013\",\"-0.011\"],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.015\",\"-0.012\",\"-0.014\",\"-0.015\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.016\",\"-0.008\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.014\",\"-0.013\",\"-0.014\",\"-\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.017\",\"-0.015\",\"-0.013\",\"-0.011\",\"-0.012\",\"-0.015\",\"-\",\"-0.011\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.015\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.011\",\"-0.014\",\"-0.011\",\"-0.012\",\"-0.014\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.017\",\"-0.01\",\"-\",\"-0.014\",\"-\",\"-0.013\",\"-0.012\"],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-0.015\",\"-0.014\",\"-0.014\",\"-0.015\",\"-0.012\",\"-0.014\",\"-0.011\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.014\",\"-0.012\",\"-0.014\",\"-0.01\",\"-\",\"-0.012\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.014\",\"-0.012\",\"-0.013\",\"-0.016\",\"-\",\"-0.011\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.012\",\"-0.014\",\"-0.011\",\"-0.012\",\"-0.015\",\"-\",\"-0.014\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.018\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-0.015\",\"-0.011\",\"-0.014\",\"-0.012\",\"-\",\"-0.012\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-0.01\",\"-\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.012\",\"-0.017\",\"-0.011\",\"-\",\"-0.013\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.014\",\"-\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.015\",\"-0.013\",\"-0.012\",\"-0.012\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.012\",\"-0.014\",\"-0.011\",\"-0.012\",\"-0.015\",\"-\",\"-0.013\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.015\",\"-0.011\",\"-0.014\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.011\",\"-0.013\",\"-0.011\",\"-0.016\",\"-0.01\",\"-\",\"-0.01\",\"-0.013\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.012\",\"-0.013\",\"-0.012\",\"-0.012\",\"-0.013\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.013\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.012\",\"-0.015\",\"-0.011\",\"-0.013\",\"-\",\"-\",\"-0.014\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.018\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.015\",\"-0.011\",\"-0.014\",\"-0.012\",\"-\",\"-0.012\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.019\",\"-0.012\",\"-0.014\",\"-0.011\",\"-0.015\",\"-0.009\",\"-\",\"-0.012\",\"-0.011\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.012\",\"-0.01\",\"-\",\"-0.013\",\"-0.013\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.015\",\"-0.011\",\"-0.012\",\"-\",\"-\",\"-0.013\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.018\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-0.015\",\"-0.011\",\"-0.015\",\"-\",\"-\",\"-0.014\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-0.016\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.015\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.011\",\"-0.012\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.015\",\"-0.01\",\"-0.013\",\"-\",\"-\",\"-0.013\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.018\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-0.015\",\"-0.011\",\"-0.015\",\"-0.013\",\"-\",\"-0.014\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-0.015\",\"-0.01\",\"-\",\"-0.012\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.015\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.011\",\"-0.014\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.015\",\"-0.01\",\"-0.013\",\"-\",\"-\",\"-0.013\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.014\",\"-0.015\",\"-0.011\",\"-0.015\",\"-0.012\",\"-\",\"-0.014\",\"-0.012\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.017\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.015\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.011\",\"-0.012\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.011\",\"-0.013\",\"-0.015\",\"-0.01\",\"-0.013\",\"-\",\"-\",\"-0.013\",\"-0.01\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.018\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.015\",\"-0.012\",\"-0.013\",\"-\",\"-\",\"-0.013\",\"-0.01\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-0.017\",\"-0.013\",\"-0.014\",\"-0.012\",\"-0.012\",\"-0.01\",\"-\",\"-0.012\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.011\",\"-0.011\",\"-\",\"-\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.016\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.015\",\"-0.012\",\"-0.013\",\"-\",\"-\",\"-0.013\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.017\",\"-0.015\",\"-0.014\",\"-0.012\",\"-0.012\",\"-0.011\",\"-\",\"-0.013\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.013\",\"-0.012\",\"-0.011\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.016\",\"-0.01\",\"-\",\"-0.011\",\"-\",\"-0.014\",\"-0.01\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[\"-\",\"-\",\"-\",\"-0.017\",\"-0.009\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.013\",\"-0.015\",\"-0.012\",\"-0.013\",\"-0.015\",\"-\",\"-0.013\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.014\",\"-0.014\",\"-0.012\",\"-0.012\",\"-0.011\",\"-\",\"-0.013\",\"-0.012\",\"-\",\"-\",\"-\",\"-0.014\",\"-0.015\",\"-\",\"-\",\"-\",\"-0.013\",\"-0.011\",\"-0.014\",\"-0.011\",\"-0.011\",\"-0.012\",\"-\",\"-0.014\",\"-0.011\",\"-\",\"-\",\"-\",\"-0.015\",\"-0.01\",\"-\",\"-\",\"-\",\"-0.012\",\"-0.014\",\"-0.016\",\"-0.01\",\"-\",\"-0.01\",\"-\",\"-0.014\",\"-0.011\",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>year<\\/th>\\n      <th>kpi<\\/th>\\n      <th>Jan<\\/th>\\n      <th>Feb<\\/th>\\n      <th>Mar<\\/th>\\n      <th>Apr<\\/th>\\n      <th>May<\\/th>\\n      <th>Jun<\\/th>\\n      <th>Jul<\\/th>\\n      <th>Aug<\\/th>\\n      <th>Sep<\\/th>\\n      <th>Oct<\\/th>\\n      <th>Nov<\\/th>\\n      <th>Dec<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":17,\"fixedColumns\":{\"leftColumns\":2},\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif', 'font-size': '12px'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif', 'font-size': '12px'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":0},{\"name\":\"year\",\"targets\":0},{\"name\":\"kpi\",\"targets\":1},{\"name\":\"Jan\",\"targets\":2},{\"name\":\"Feb\",\"targets\":3},{\"name\":\"Mar\",\"targets\":4},{\"name\":\"Apr\",\"targets\":5},{\"name\":\"May\",\"targets\":6},{\"name\":\"Jun\",\"targets\":7},{\"name\":\"Jul\",\"targets\":8},{\"name\":\"Aug\",\"targets\":9},{\"name\":\"Sep\",\"targets\":10},{\"name\":\"Oct\",\"targets\":11},{\"name\":\"Nov\",\"targets\":12},{\"name\":\"Dec\",\"targets\":13}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[10,17,25,50,100]},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n</div>\n</div>\n</div>\n</div>\n```\n\n:::\n:::\n\n\n\nComparing the output of Global Moran's I across year and across year and month, they generally point to the same insight. The impact of covid can be somewhat observed as the key indicators are less statistically significant during 2020-2021.\n\nTherefore, I can conclude that some key indicators of Thailand tourism economy are spatial and spatio-temporal dependent.\n\n# 4 Local Spatial Autocorrelation Analysis of Thailand Tourism Key Indicators\n\nTo identify where are clusters and outliers, `local_moran` of the `sfdep` package will be used. The indicators that will be analysed are those that have been proven to be spatially dependent. To ensure that analysis are mindfully conducted, the local spatial autocorrelation analysis will be done across space first.\n\nFollowing which, carefully selected indicators will then be used with Local Moran's I across year and year and month.\n\nFurthermore, While I can continue to do emerging hotspot analysis (EHSA) with `local_gstar_perm` from `sfdep` package for each individual time period, this will be explored in greater depth with the time dimension in a continuous fashion (as compared to the discrete way that it has been done for Global Moran's I). The rationale for this is that for EHSA aims to see how hot/cold spots change *over time*.\n\n## 4.1 Local Moran's I across Space\n\nThe main tourism key indicators are revenue proportion (Thai vs Foreign), tourist proportion (Thai vs Foreign), Revenue/Tourist (all tourist, Thai, Foreign), and Overnight Guest (revenue/overnight guest, proportion of tourists who stayed overnight)\n\nA similar process will be conducted iteratively for each key indicator 1. Set seed 2. Run Local Moran's I 3. Visualize Local Moran's I statistics and p-value from Step 2 4. Filter results by p-value \\<= 0.05 5. Visualize LISA chart from Step 4\n\n::: panel-tabset\n# Revenue\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(24)\n\n# Thai Revenue Proportion\nlisa_th <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_thai_prop, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Foreign Revenue Proportion\nlisa_fr <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_foreign_prop, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Visualize statistics and p-value plots for all key indicators together \ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_th) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Thai Revenue Proportion\",\n            main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_th) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Foreign Revenue Proportion)\",\n            main.title.size = 0.8)\n\nmap3 <- tm_shape(lisa_fr) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Foreign Revenue Proportion\",\n            main.title.size = 0.8)\n\nmap4 <- tm_shape(lisa_fr) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Foreign Revenue Proportion)\",\n            main.title.size = 0.8)\n\n\ntmap_arrange(map1, map2, map3, map4, ncol = 2, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-58-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter output for only those that are statistically significant\nlisa_th_sig <- lisa_th  %>%\n  filter(p_ii_sim < 0.05)\nlisa_fr_sig <- lisa_fr  %>%\n  filter(p_ii_sim < 0.05)\n\n# Visualize LISA maps for both Key indicators side by side\ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_th) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_th_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Thai Revenue Proportion\",\n          main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_fr) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_fr_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Foreign Revenue Proportion\",\n          main.title.size = 0.8)\n\ntmap_arrange(map1, map2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-59-1.png){width=576}\n:::\n:::\n\n\n\n# Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(24)\n\n# Thai Tourist Proportion\nlisa_th <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    tourist_thai_prop, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Foreign Tourist Proportion\nlisa_fr <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    tourist_foreign_prop, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Visualize statistics and p-value plots for both key indicators together \ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_th) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Thai Tourist Proportion\",\n            main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_th) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Foreign Tourist Proportion)\",\n            main.title.size = 0.8)\n\nmap3 <- tm_shape(lisa_fr) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Foreign Tourist Proportion\",\n            main.title.size = 0.8)\n\nmap4 <- tm_shape(lisa_fr) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Foreign Tourist Proportion)\",\n            main.title.size = 0.8)\n\n\ntmap_arrange(map1, map2, map3, map4, ncol = 2, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-60-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter output for only those that are statistically significant\nlisa_th_sig <- lisa_th  %>%\n  filter(p_ii_sim < 0.05)\nlisa_fr_sig <- lisa_fr  %>%\n  filter(p_ii_sim < 0.05)\n\n# Visualize LISA maps for both Key indicators side by side\ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_th) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_th_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Thai Tourist Proportion\",\n          main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_fr) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_fr_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Foreign Tourist Proportion\",\n          main.title.size = 0.8)\n\ntmap_arrange(map1, map2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-61-1.png){width=576}\n:::\n:::\n\n\n\n# Revenue/Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(24)\n\n# Revenue/Tourist\nlisa_all <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_tourist_all, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Thai Revenue/Thai Tourist\nlisa_th <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_tourist_thai, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Foreign Revenue/Foreign Tourist\nlisa_fr <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_tourist_foreign, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Visualize statistics and p-value plots for all key indicators together \ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_all) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Revenue/Tourist\",\n            main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_all) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Revenue/Tourist)\",\n            main.title.size = 0.8)\n\nmap3 <- tm_shape(lisa_th) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Revenue/Tourist (Thai)\",\n            main.title.size = 0.8)\n\nmap4 <- tm_shape(lisa_th) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Revenue/Tourist (Thai))\",\n            main.title.size = 0.8)\n\nmap5 <- tm_shape(lisa_fr) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Revenue/Tourist (Foreign)\",\n            main.title.size = 0.8)\n\nmap6 <- tm_shape(lisa_fr) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Revenue/Tourist (Foreign))\",\n            main.title.size = 0.8)\n\n\ntmap_arrange(map1, map2, map3, map4, map5, map6, ncol = 2, nrow = 3)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-62-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter output for only those that are statistically significant\nlisa_all_sig <- lisa_all  %>%\n  filter(p_ii_sim < 0.05)\nlisa_th_sig <- lisa_th  %>%\n  filter(p_ii_sim < 0.05)\nlisa_fr_sig <- lisa_fr  %>%\n  filter(p_ii_sim < 0.05)\n\n# Visualize LISA maps for all Key indicators side by side\ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_all) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_all_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Revenue/Tourist\",\n          main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_th) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_th_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Revenue/Tourist (Thai)\",\n          main.title.size = 0.8)\n\nmap3 <- tm_shape(lisa_fr) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_fr_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Revenue/Tourist (Foreign)\",\n          main.title.size = 0.8)\n\ntmap_arrange(map1, map2, map3, ncol = 3)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-63-1.png){width=576}\n:::\n:::\n\n\n\n# Overnight Guest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(24)\n\n# Revenue/Overnight Guest\nlisa_og <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    revenue_tourist_stay, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Proportion of Tourist who stay overnight\nlisa_ogp <- th_tour_knn5_all %>%\n  mutate(local_moran = local_moran(\n    tourist_stay_all, nb, wt, nsim = 999),\n    .before = 1) %>%\n  unnest(local_moran)\n\n# Visualize statistics and p-value plots for both key indicators together \ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_og) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Revenue/Overnight Guest\",\n            main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_og) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Revenue/Overnight Guest)\",\n            main.title.size = 0.8)\n\nmap3 <- tm_shape(lisa_ogp) +\n  tm_fill(\"ii\") + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"local Moran's I of Overnight Tourist Proportion \",\n            main.title.size = 0.8)\n\nmap4 <- tm_shape(lisa_ogp) +\n  tm_fill(\"p_ii_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n              labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\")) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"p-value of local Moran's I (Overnight Tourist Proportion)\",\n            main.title.size = 0.8)\n\n\ntmap_arrange(map1, map2, map3, map4, ncol = 2, nrow = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-64-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter output for only those that are statistically significant\nlisa_og_sig <- lisa_og  %>%\n  filter(p_ii_sim < 0.05)\nlisa_ogp_sig <- lisa_ogp  %>%\n  filter(p_ii_sim < 0.05)\n\n# Visualize LISA maps for both Key indicators side by side\ntmap_mode(\"plot\")\nmap1 <- tm_shape(lisa_og) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_og_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Revenue/Overnight Guest\",\n          main.title.size = 0.8)\n\nmap2 <- tm_shape(lisa_ogp) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\n  tm_shape(lisa_ogp_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) + \n  tm_layout(main.title = \"LISA Map of Overnight Tourist Proportion\",\n          main.title.size = 0.8)\n\ntmap_arrange(map1, map2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-65-1.png){width=576}\n:::\n:::\n\n\n:::\n\nUnsurprisingly the plots for Revenue and Tourist are very similar. Nevertheless, they serve as a good indictor to show regions that are largely driven by foreign tourism (\"High-High\" on foreign proportion - near Phuket) and regions that are largely driven by domestic tourism (\"High-High\" on Thai proportion - near Nakhon Sawan).\n\nThe revenue spent per tourist highlights Bangkok as an outlier (\"High-High\") for both foreign and Thai tourists, signifying its status as a key tourist destination. Comparing the expenditure per Tourist for both foreign and Thai tourists, Khon Kaen stands out (\"High-Low\") for Thai tourist, suggesting a local tourist destination. Phatthalung stands out as \"Low-High\", suggesting that it is not as attractive to foreign tourists.\n\nLooking at overnight guest indicators, while the revenue/overnight guests presents similar clusters as those in revenue/tourist, proportion of guests staying overnight highlights other insights. The \"Low-High\" of Phang Nga affirms the EDA hypothesis of tourists behaviour - wherein they are likely to center their trip around Phuket and making day trips to provinces around. Bangkok showing up as \"High-Low\" further cements its status as a main tourist destination.\n\n## 4.2 Local Moran's I across Space and Time (Year)\n\nGiven the iterative process and charts, I created a function to generate the LISA chart. Using another function that iterates across different years, I can then visualize the changes with `tmap_animation`. While the Local Moran's I and p-value charts are not shown, it is believed that the main takeaway of the Local Moran's I is in the LISA chart (in order to identify clusters and outliers).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to generate LISA maps\nlocal_moran_space <- function(data, col, value, kpi) {\n  # Set Seed\n  set.seed(42)\n  \n  # Filter sf dataframe\n  filtered_data <- data %>%\n    filter(!!sym(col) == value)\n  \n  # Append neighbour list and calculate spatial weight matrix\n  filtered_data <- filtered_data %>%\n    mutate(nb = nb_knn_5,\n           wt = st_weights(nb, style = \"W\"),\n           wt_inv = st_inverse_distance(include_self(nb), geometry = coords_cent, \n                                        scale = 100, alpha = 1),\n           local_moran = local_moran(!!sym(kpi), nb, wt, nsim = 999),\n           .before = 1) %>%\n    unnest(local_moran)\n  \n  # Filter out non-significant results\n  filter_sig <- filtered_data  %>%\n    filter(p_ii_sim < 0.05)\n  \n  # Visualize clusters with LISA map\n  map1 <- tm_shape(filtered_data) +\n    tm_polygons() +\n    tm_borders(alpha = 0.5) +\n    tm_shape(filter_sig) +\n    tm_fill(\"mean\") + \n    tm_borders(alpha = 0.4) + \n    tm_layout(main.title = paste0(\"LISA Map of \",kpi,\" (\",value, \")\"),\n              main.title.size = 0.4,\n              legend.text.size = 0.3,\n              legend.title.size = 0.4)\n\n  return(map3)\n}\n```\n:::\n\n\n\n::: panel-tabset\n# Revenue\n\nFirst, the animated chart for \"revenue_thai_prop\" has to be created.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_thai_prop\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_thai_prop_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n\n\nNow I can view the LISA chart across each year.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_thai_prop_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_thai_prop_year.gif)\n:::\n:::\n\n\n\nNow i do the same for \"revenue_foreign_prop\".\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_foreign_prop\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_foreign_prop_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n\n\nAnd now I can visualize the gif.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_foreign_prop_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_foreign_prop_year.gif)\n:::\n:::\n\n\n\n# Revenue/Tourist\n\nIn Revenue/Tourist, I am interested in \"revenue_tourist_all\", \"revenue_tourist_thai\" and \"revenue_tourist_foreign\". Lets create and view the gif for each of them.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_all\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_all_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_all_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_all_year.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_thai\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_thai_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_thai_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_thai_year.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_foreign\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_foreign_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_foreign_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_foreign_year.gif)\n:::\n:::\n\n\n\n# Overnight Guest\n\nFinally, for overnight guest key indicators, I'm interested in how the LISA chart will act for \"revenue_tourist_stay\" and \"tourist_stay_all\".\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_stay\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_stay_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_stay_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_stay_year.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year, \n                                  col = \"year\", \n                                  value = value, \n                                  kpi = \"tourist_stay_all\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_tourist_stay_all_year.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_tourist_stay_all_year.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_tourist_stay_all_year.gif)\n:::\n:::\n\n\n:::\n\nWhen looking at the revenue proportion for Foreign tourists, I can see a group of provinces surrounding Phuket (exhibiting \"high-high\" behaviour across the years. They in turn are then surrounded by provinces exhibiting \"low-high\" for 2019-2020. In 2022, Krabi changed from \"high-high\" to \"low-low\", suggesting the impact of Covid on how foreign tourists not travelling less further from Phuket. Provinces intersperse around the middle of Thailand are \"low-low\" throughout the years, highlighting how tourism is driven by domestic travel in those provinces.\n\nLooking at revenue per tourists, Bangkok is highlighted as \"High-low\" from 2019-2022. Zooming into foreign revenue per foreign tourist, Kachanaburi (border province) shows up as \"High-low\" during 2020. This could be because of Covid, more revenue generated from foreign tourists travelling across the border. A sizable number of provinces around the middle of Thailand are \"low-low\" throughout the years, for both foreign and Thai tourists, suggesting that either tourists do not spend much in those areas or goods and services are much cheaper in those areas.\n\nThe proportion of tourists who stay overnight shows how covid impacted Tourism, with Bangkok being \"Low-Low\" from 2021-2022.\n\n## 4.3 Local Moran's I across Space and Time (Year and Month)\n\nA slight adjustment when performing Local Moran's I across year and month is to reference the appropriate sf dataframe, the corresponding date column and list of dates. They have been used earlier when performing Global Moran's I, therefore I am able to reuse those objects. Key indicators used will mirror that of 4.2 for consistency.\n\n::: panel-tabset\n# Revenue\n\nIn Revenue, I will still be looking at \"revenue_thai_prop\" and \"revenue_foreign_prop\"\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_thai_prop\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_thai_prop_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_thai_prop_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_thai_prop_year_month.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_foreign_prop\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_foreign_prop_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_foreign_prop_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_foreign_prop_year_month.gif)\n:::\n:::\n\n\n\n# Revenue/Tourist\n\nIn Revenue/Tourist, I am interested in \"revenue_tourist_all\", \"revenue_tourist_thai\" and \"revenue_tourist_foreign\". Lets create and view the gif for each of them.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_all\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_all_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_all_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_all_year_month.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_thai\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_thai_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_thai_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_thai_year_month.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_foreign\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_foreign_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_foreign_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_foreign_year_month.gif)\n:::\n:::\n\n\n\n# Overnight Guest\n\nLikewise, I will do the same for the \"revenue_tourist_stay\" and \"tourist_stay_all\".\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"revenue_tourist_stay\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_revenue_tourist_stay_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_revenue_tourist_stay_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_revenue_tourist_stay_year_month.gif)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_local_moran_maps <- lapply(year_month_list, function(value) {\n  # Call the local_moran_space function for each value in the list\n  map_result <- local_moran_space(data = th_bound_tour_year_month, \n                                  col = \"date.y\", \n                                  value = value, \n                                  kpi = \"tourist_stay_all\")\n  \n  return(map_result)  # Store the resulting map\n})\n\ntmap_animation(all_local_moran_maps, filename = \"images/animated_tourist_stay_all_year_month.gif\",\n               width = 1000, height = 1000, dpi = 300, delay = 50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize gif\nknitr::include_graphics(\"images/animated_tourist_stay_all_year_month.gif\")\n```\n\n::: {.cell-output-display}\n![](images/animated_tourist_stay_all_year_month.gif)\n:::\n:::\n\n\n:::\n\nWhen performing Local Moran's I at a more granular level, observations align with those for Local Moran's I across year. An additional insight is that the impact of covid can be more clearly observed with clusters/outliers becoming extremely sparse during the covid period.\n\n# 5 Spatio-Temporal Analysis of Thailand Tourism Key Indicators\n\nTo perform spatio-temporal analysis, I will be conducting the Mann-Kendall test with `MannKendall` from `Kendall` package for a brief look of emerging hotspots/coldspots, then a more rigorous Emerging Hotspot Analysis (EHSA) with `emerging_hotspot_analysis` from `sfdep` package.\n\n## 5.1 Preprocessing\n\nBefore proceeding for EHSA, a spacetime cube has to be created first. This will be done using `spacetime` from sfdep package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load geospatial data\nth_bound <- st_read(dsn = \"data/tha_adm_rtsd_itos_20210121_shp/\", layer = \"tha_admbnda_adm1_rtsd_20220121\") %>%\n  st_transform(crs = 32647)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm1_rtsd_20220121' from data source \n  `C:\\Users\\Henry\\Desktop\\SMU Masters\\2024-2025 T1\\Geospatial Analytics & Applications\\Project\\GeospatialWebsite\\Take-Home_Ex\\Take-Home_Ex_02\\data\\tha_adm_rtsd_itos_20210121_shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load processed aspatial data\nth_aspatial <- read_rds('data/processed/tbl_tourism_wide.rds') %>%\n  mutate(date_int = year(date)*12 + month(date)) %>%\n  rename(ADM1_EN = province_eng)\n\n# Create spacetime cube\nth_bound_spt <- spacetime(th_aspatial, th_bound, .loc_col = \"ADM1_EN\", .time_col = \"date_int\")\n\n\n# Check spacetime cube\nis_spacetime_cube(th_bound_spt)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Apply neighbour list and spatial weights\nth_bound_nb <- th_bound_spt %>%\n  activate(\"geometry\") %>%\n  mutate(nb = include_self(nb_knn_5),\n         wt = st_weights(nb),\n         .before = 1) %>%\n  set_nbs(\"nb\") %>%\n  set_wts(\"wt\")\n```\n:::\n\n\n\n## 5.2 Mann-Kendall Test\n\nIn order to run Mann-Kendall test more efficiently for different key indicators, I'll use a function. The function is as follows:\n\n1.  Set seed\n2.  Compute Gi\\*\n3.  Perform Mann-Kendall Test for each province\n4.  Post processing\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to run Mann-Kendall iteratively\nmann_kendall_function <- function(data, kpi) {\n  # Set seed\n  set.seed(42)\n  \n  # Compute Gi*\n  gi_stars <- data %>%\n    group_by(date) %>%\n    mutate(gi_star = local_gstar_perm(!!sym(kpi), nb, wt)) %>%\n    tidyr::unnest(gi_star)\n  \n  # Perform Mann-Kendall for each Province\n  ehsa <- gi_stars %>%\n    group_by(ADM1_EN) %>%\n    summarise(mk = list(unclass(Kendall::MannKendall(gi_star)))) %>%\n    tidyr::unnest_wider(mk)\n  \n  # Process output\n  emerging <- ehsa %>%\n    mutate(tau = round(tau, 5),\n           sl = round(sl, 5),\n           varS = round(varS, 3)) %>%\n    arrange(sl, abs(tau))\n  \n  return(emerging)\n}\n```\n:::\n\n\n\n::: panel-tabset\n# Revenue\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for foreign revenue proportion\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_foreign_prop\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-6aa5d44baf2c998d4acd\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-6aa5d44baf2c998d4acd\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Nakhon Phanom\",\"Uttaradit\",\"Kalasin\",\"Nakhon Ratchasima\",\"Ratchaburi\",\"Buri Ram\",\"Pathum Thani\",\"Udon Thani\",\"Phra Nakhon Si Ayutthaya\",\"Trat\",\"Ubon Ratchathani\",\"Krabi\",\"Mae Hong Son\",\"Sing Buri\",\"Nakhon Si Thammarat\",\"Trang\",\"Surat Thani\",\"Bueng Kan\",\"Ranong\",\"Samut Songkhram\",\"Chon Buri\",\"Loei\",\"Sakon Nakhon\",\"Yala\",\"Chiang Mai\",\"Kanchanaburi\",\"Tak\",\"Nonthaburi\",\"Nakhon Sawan\",\"Phetchaburi\",\"Yasothon\",\"Chanthaburi\",\"Roi Et\",\"Phuket\",\"Nakhon Nayok\",\"Suphan Buri\",\"Sa Kaeo\",\"Surin\",\"Uthai Thani\",\"Narathiwat\",\"Amnat Charoen\",\"Khon Kaen\",\"Prachuap Khiri Khan\",\"Chai Nat\",\"Lamphun\",\"Ang Thong\",\"Lampang\",\"Phetchabun\",\"Samut Sakhon\",\"Sukhothai\",\"Nan\",\"Chachoengsao\",\"Satun\",\"Phitsanulok\",\"Mukdahan\",\"Phatthalung\",\"Maha Sarakham\",\"Prachin Buri\",\"Samut Prakan\",\"Chiang Rai\",\"Pattani\",\"Bangkok\",\"Chumphon\",\"Phrae\",\"Saraburi\",\"Kamphaeng Phet\",\"Nong Bua Lam Phu\",\"Phangnga\",\"Phichit\",\"Nong Khai\",\"Songkhla\",\"Lop Buri\",\"Phayao\",\"Chaiyaphum\",\"Nakhon Pathom\",\"Si Sa Ket\",\"Rayong\"],[0.45306,0.46612,-0.5298,-0.53306,-0.54939,-0.57878,-0.62122,0.66531,-0.39755,-0.39265,-0.37469,-0.36653,-0.34204,0.32735,-0.32245,-0.32082,-0.31755,0.31429,-0.30939,-0.30612,-0.30286,0.29796,0.29143,-0.2898,0.28816,0.28653,0.28653,0.2849,0.28163,-0.28,-0.27673,0.2751,0.27184,0.26367,-0.25714,0.25551,0.25224,0.24408,0.24245,-0.23429,0.23265,0.22939,-0.22612,0.2049,0.20327,0.2,-0.19673,0.1951,0.18531,-0.18367,0.17061,-0.15755,-0.15429,0.15265,-0.14286,0.14122,-0.13306,-0.13143,-0.12,0.11837,-0.11673,0.1151,0.1151,-0.1151,-0.10857,-0.08735,-0.05469,-0.05306,-0.05143,-0.03673,0.03673,0.03347,0.0302,-0.01388,0.00408,-0.00408,-0.00082],[0,0,0,0,0,0,0,0,5e-05,6e-05,0.00013,0.00018,0.00047,0.00082,0.00098,0.00104,0.00117,0.00132,0.00157,0.00176,0.00197,0.00233,0.0029,0.00306,0.00324,0.00341,0.00341,0.0036,0.00401,0.00423,0.00469,0.00495,0.00548,0.00707,0.008630000000000001,0.00906,0.009979999999999999,0.01268,0.01329,0.01674,0.01752,0.01917,0.02096,0.03651,0.03803,0.04125,0.04469,0.0465,0.0587,0.06097,0.08187999999999999,0.10826,0.11581,0.11974,0.14553,0.15022,0.17538,0.18077,0.22198,0.22838,0.23491,0.24157,0.24157,0.24157,0.26952,0.37525,0.58089,0.59241,0.60402,0.71283,0.71283,0.73793,0.76331,0.89353,0.97331,0.97331,1],[555,571,-649,-653,-673,-709,-761,815,-487,-481,-459,-449,-419,401,-395,-393,-389,385,-379,-375,-371,365,357,-355,353,351,351,349,345,-343,-339,337,333,323,-315,313,309,299,297,-287,285,281,-277,251,249,245,-241,239,227,-225,209,-193,-189,187,-175,173,-163,-161,-147,145,-143,141,141,-141,-133,-107,-67,-65,-63,-45,45,41,37,-17,5,-5,-1],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for thai revenue proportion\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_thai_prop\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-f7b3d6b166a12798bcac\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f7b3d6b166a12798bcac\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Uttaradit\",\"Nakhon Ratchasima\",\"Kalasin\",\"Ratchaburi\",\"Buri Ram\",\"Pathum Thani\",\"Udon Thani\",\"Nakhon Phanom\",\"Trat\",\"Phra Nakhon Si Ayutthaya\",\"Ubon Ratchathani\",\"Krabi\",\"Sing Buri\",\"Trang\",\"Surat Thani\",\"Ranong\",\"Chon Buri\",\"Yala\",\"Mae Hong Son\",\"Yasothon\",\"Chiang Mai\",\"Loei\",\"Nakhon Sawan\",\"Nakhon Nayok\",\"Bueng Kan\",\"Roi Et\",\"Chanthaburi\",\"Phuket\",\"Phetchaburi\",\"Tak\",\"Samut Songkhram\",\"Nakhon Si Thammarat\",\"Sa Kaeo\",\"Uthai Thani\",\"Sakon Nakhon\",\"Nonthaburi\",\"Prachuap Khiri Khan\",\"Surin\",\"Kanchanaburi\",\"Sukhothai\",\"Amnat Charoen\",\"Narathiwat\",\"Khon Kaen\",\"Phetchabun\",\"Suphan Buri\",\"Chai Nat\",\"Lampang\",\"Nan\",\"Samut Prakan\",\"Chachoengsao\",\"Lamphun\",\"Samut Sakhon\",\"Phatthalung\",\"Ang Thong\",\"Satun\",\"Prachin Buri\",\"Phrae\",\"Kamphaeng Phet\",\"Maha Sarakham\",\"Chiang Rai\",\"Bangkok\",\"Saraburi\",\"Pattani\",\"Phitsanulok\",\"Mukdahan\",\"Chumphon\",\"Phangnga\",\"Nong Bua Lam Phu\",\"Si Sa Ket\",\"Phayao\",\"Phichit\",\"Songkhla\",\"Rayong\",\"Nong Khai\",\"Lop Buri\",\"Chaiyaphum\",\"Nakhon Pathom\"],[-0.4498,0.46776,0.5249,0.5298,0.53469,0.58857,-0.59837,-0.4351,0.39265,0.38286,0.37469,0.35837,-0.34857,0.32898,0.32082,0.31102,0.29306,0.28653,0.28,0.27837,-0.27673,-0.27347,-0.2702,0.26531,-0.26367,-0.26041,-0.25551,-0.25551,0.25388,-0.25388,0.25224,0.24082,-0.23755,-0.23592,-0.23429,-0.23265,0.23265,-0.22939,-0.22612,0.22122,-0.21796,0.21469,-0.20653,-0.2049,-0.1951,-0.18531,0.18041,-0.17224,0.16408,0.16245,-0.16082,-0.15429,-0.14939,-0.14612,0.13143,0.1298,0.12653,0.1151,0.11184,-0.1102,-0.10367,0.10367,0.09714,-0.08898,0.08245,-0.07428999999999999,0.06286,0.05469,0.05306,-0.04816,0.0449,-0.04,0.03347,0.01714,-0.01388,0.01061,-0.00898],[0,0,0,0,0,0,0,1e-05,6e-05,9.000000000000001e-05,0.00013,0.00025,0.00037,0.00077,0.00104,0.00148,0.00275,0.00341,0.00423,0.00445,0.00469,0.00521,0.00577,0.00672,0.00707,0.00781,0.00906,0.00906,0.009509999999999999,0.009509999999999999,0.009979999999999999,0.01392,0.01527,0.01599,0.01674,0.01752,0.01752,0.01917,0.02096,0.02391,0.02608,0.02841,0.03504,0.03651,0.0465,0.0587,0.06573,0.07897999999999999,0.09433,0.09767000000000001,0.10111,0.11581,0.12791,0.1365,0.18077,0.18629,0.19768,0.24157,0.25528,0.26233,0.2919,0.2919,0.32362,0.36631,0.40288,0.45155,0.52495,0.58089,0.59241,0.62756,0.6514799999999999,0.68804,0.73793,0.86714,0.89353,0.92004,0.9333399999999999],[-551,573,643,649,655,721,-733,-533,481,469,459,439,-427,403,393,381,359,351,343,341,-339,-335,-331,325,-323,-319,-313,-313,311,-311,309,295,-291,-289,-287,-285,285,-281,-277,271,-267,263,-253,-251,-239,-227,221,-211,201,199,-197,-189,-183,-179,161,159,155,141,137,-135,-127,127,119,-109,101,-91,77,67,65,-59,55,-49,41,21,-17,13,-11],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n# Revenue/Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for revenue/tourist\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_tourist_all\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-a42f9da03acb42ac5942\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a42f9da03acb42ac5942\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Phrae\",\"Phra Nakhon Si Ayutthaya\",\"Samut Sakhon\",\"Sukhothai\",\"Chanthaburi\",\"Sa Kaeo\",\"Nakhon Phanom\",\"Sakon Nakhon\",\"Nong Khai\",\"Khon Kaen\",\"Amnat Charoen\",\"Phitsanulok\",\"Kamphaeng Phet\",\"Tak\",\"Lop Buri\",\"Satun\",\"Phangnga\",\"Phetchaburi\",\"Prachin Buri\",\"Ang Thong\",\"Chiang Mai\",\"Saraburi\",\"Phatthalung\",\"Phetchabun\",\"Surat Thani\",\"Loei\",\"Phuket\",\"Nakhon Sawan\",\"Lampang\",\"Uthai Thani\",\"Nakhon Pathom\",\"Krabi\",\"Chon Buri\",\"Bangkok\",\"Ranong\",\"Prachuap Khiri Khan\",\"Uttaradit\",\"Yala\",\"Chachoengsao\",\"Lamphun\",\"Sing Buri\",\"Si Sa Ket\",\"Pattani\",\"Narathiwat\",\"Samut Prakan\",\"Phayao\",\"Chaiyaphum\",\"Rayong\",\"Phichit\",\"Roi Et\",\"Bueng Kan\",\"Nan\",\"Mae Hong Son\",\"Nakhon Ratchasima\",\"Nonthaburi\",\"Nakhon Si Thammarat\",\"Suphan Buri\",\"Samut Songkhram\",\"Buri Ram\",\"Kanchanaburi\",\"Chai Nat\",\"Nong Bua Lam Phu\",\"Kalasin\",\"Ratchaburi\",\"Ubon Ratchathani\",\"Yasothon\",\"Trang\",\"Trat\",\"Chiang Rai\",\"Udon Thani\",\"Mukdahan\",\"Pathum Thani\",\"Songkhla\",\"Maha Sarakham\",\"Surin\",\"Nakhon Nayok\",\"Chumphon\"],[0.4498,-0.45143,0.45469,0.45633,0.45796,0.45959,0.47265,0.48571,-0.48735,0.49061,0.49388,0.50531,0.5298,0.53306,-0.53633,-0.53959,-0.54612,-0.54612,-0.5542899999999999,0.56735,0.6,0.61633,-0.61796,0.62449,-0.71429,0.4302,0.43673,0.43837,-0.41714,0.40571,0.39592,-0.39265,-0.39429,-0.37633,-0.37469,-0.35673,0.35347,-0.34857,-0.34694,0.34531,0.34531,0.33878,-0.33061,-0.32571,-0.32082,-0.31265,-0.30449,0.30286,-0.30122,0.29959,0.29796,-0.2898,-0.2849,-0.28,0.26857,-0.26531,0.26367,-0.24898,-0.21469,0.21306,0.20327,-0.20163,-0.1902,-0.17714,-0.17224,0.17224,-0.15592,0.14776,-0.12816,0.12163,0.11837,-0.08735,-0.08735,0.07592,-0.07428999999999999,-0.03673,0.01061],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-05,1e-05,1e-05,2e-05,3e-05,5e-05,6e-05,6e-05,0.00012,0.00013,0.00027,0.0003,0.00037,0.00039,0.00042,0.00042,0.00053,0.00073,0.00087,0.00104,0.0014,0.00186,0.00197,0.00208,0.0022,0.00233,0.00306,0.0036,0.00423,0.00608,0.00672,0.00707,0.01099,0.02841,0.02964,0.03803,0.03961,0.0523,0.07079000000000001,0.07897999999999999,0.07897999999999999,0.11199,0.13215,0.19192,0.21572,0.22838,0.37525,0.37525,0.44156,0.45155,0.71283,0.92004],[551,-553,557,559,561,563,579,595,-597,601,605,619,649,653,-657,-661,-669,-669,-679,695,735,755,-757,765,-875,527,535,537,-511,497,485,-481,-483,-461,-459,-437,433,-427,-425,423,423,415,-405,-399,-393,-383,-373,371,-369,367,365,-355,-349,-343,329,-325,323,-305,-263,261,249,-247,-233,-217,-211,211,-191,181,-157,149,145,-107,-107,93,-91,-45,13],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for revenue/tourist (Thai)\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_tourist_thai\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-bae45778a8734ef7bc3b\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-bae45778a8734ef7bc3b\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Udon Thani\",\"Nonthaburi\",\"Lampang\",\"Kamphaeng Phet\",\"Chiang Mai\",\"Suphan Buri\",\"Chanthaburi\",\"Saraburi\",\"Sa Kaeo\",\"Surin\",\"Nakhon Si Thammarat\",\"Nakhon Nayok\",\"Krabi\",\"Chon Buri\",\"Phetchabun\",\"Mukdahan\",\"Songkhla\",\"Samut Songkhram\",\"Chai Nat\",\"Tak\",\"Maha Sarakham\",\"Trat\",\"Yala\",\"Roi Et\",\"Nakhon Sawan\",\"Bueng Kan\",\"Chiang Rai\",\"Chachoengsao\",\"Kanchanaburi\",\"Bangkok\",\"Phra Nakhon Si Ayutthaya\",\"Ranong\",\"Uttaradit\",\"Ang Thong\",\"Yasothon\",\"Phayao\",\"Pattani\",\"Ubon Ratchathani\",\"Nan\",\"Phrae\",\"Phatthalung\",\"Chumphon\",\"Trang\",\"Lop Buri\",\"Phetchaburi\",\"Samut Sakhon\",\"Nong Khai\",\"Amnat Charoen\",\"Phitsanulok\",\"Samut Prakan\",\"Si Sa Ket\",\"Sukhothai\",\"Rayong\",\"Satun\",\"Pathum Thani\",\"Surat Thani\",\"Sing Buri\",\"Nakhon Ratchasima\",\"Lamphun\",\"Nakhon Phanom\",\"Loei\",\"Sakon Nakhon\",\"Uthai Thani\",\"Phangnga\",\"Prachin Buri\",\"Prachuap Khiri Khan\",\"Nong Bua Lam Phu\",\"Nakhon Pathom\",\"Ratchaburi\",\"Mae Hong Son\",\"Narathiwat\",\"Kalasin\",\"Buri Ram\",\"Khon Kaen\",\"Phuket\",\"Chaiyaphum\",\"Phichit\"],[-0.44653,-0.45469,0.45633,0.45796,0.46286,-0.46449,0.47265,0.47918,0.48245,-0.48245,-0.48408,0.48735,-0.48898,0.50041,0.51673,-0.54449,0.56408,-0.56735,0.57061,0.57714,-0.5934700000000001,0.61469,-0.65388,-0.42531,0.42694,-0.43673,0.43837,-0.4449,-0.41714,-0.40833,0.41061,-0.40082,-0.40245,0.38776,0.38776,-0.38286,-0.38122,0.37633,-0.37143,0.37143,-0.35673,-0.34531,-0.34367,-0.33061,-0.33061,0.31102,0.2849,0.28163,0.2751,0.27184,0.26857,0.26367,0.25714,-0.25388,0.23918,0.23755,-0.23429,-0.16571,-0.16082,0.15102,-0.14286,0.1249,0.12327,0.1151,-0.11184,0.10204,-0.08570999999999999,0.07918,-0.07592,0.07428999999999999,-0.06612,0.05469,0.0498,-0.04653,0.03837,0.02531,0.00898],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-05,1e-05,1e-05,1e-05,1e-05,2e-05,3e-05,3e-05,4e-05,4e-05,6.999999999999999e-05,6.999999999999999e-05,9.000000000000001e-05,0.0001,0.00012,0.00015,0.00015,0.00027,0.00042,0.00044,0.00073,0.00073,0.00148,0.0036,0.00401,0.00495,0.00548,0.00608,0.00707,0.008630000000000001,0.009509999999999999,0.01458,0.01527,0.01674,0.09109,0.10111,0.12377,0.14553,0.20357,0.20958,0.24157,0.25528,0.29962,0.38433,0.42196,0.44156,0.45155,0.50338,0.58089,0.61574,0.63948,0.7004,0.80186,0.9333399999999999],[-547,-557,559,561,567,-569,579,587,591,-591,-593,597,-599,613,633,-667,691,-695,699,707,-727,753,-801,-521,523,-535,537,-545,-511,-500,503,-491,-493,475,475,-469,-467,461,-455,455,-437,-423,-421,-405,-405,381,349,345,337,333,329,323,315,-311,293,291,-287,-203,-197,185,-175,153,151,141,-137,125,-105,97,-93,91,-81,67,61,-57,47,31,11],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1224.499877929688,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14290.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for revenue/tourist (Foreign)\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_tourist_foreign\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-cf6eae5dd76cf3ff5b46\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-cf6eae5dd76cf3ff5b46\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Songkhla\",\"Mae Hong Son\",\"Bueng Kan\",\"Phetchaburi\",\"Chai Nat\",\"Phuket\",\"Amnat Charoen\",\"Nakhon Phanom\",\"Nakhon Sawan\",\"Nakhon Ratchasima\",\"Ranong\",\"Lamphun\",\"Phra Nakhon Si Ayutthaya\",\"Sakon Nakhon\",\"Sukhothai\",\"Pattani\",\"Tak\",\"Samut Sakhon\",\"Phrae\",\"Surat Thani\",\"Nakhon Pathom\",\"Chiang Mai\",\"Chachoengsao\",\"Krabi\",\"Uttaradit\",\"Narathiwat\",\"Satun\",\"Nakhon Nayok\",\"Sa Kaeo\",\"Loei\",\"Mukdahan\",\"Chanthaburi\",\"Prachin Buri\",\"Maha Sarakham\",\"Uthai Thani\",\"Phangnga\",\"Yasothon\",\"Sing Buri\",\"Khon Kaen\",\"Phatthalung\",\"Buri Ram\",\"Saraburi\",\"Chon Buri\",\"Suphan Buri\",\"Lampang\",\"Nong Khai\",\"Pathum Thani\",\"Udon Thani\",\"Phetchabun\",\"Kamphaeng Phet\",\"Nonthaburi\",\"Phichit\",\"Chaiyaphum\",\"Samut Songkhram\",\"Yala\",\"Ratchaburi\",\"Bangkok\",\"Phayao\",\"Si Sa Ket\",\"Rayong\",\"Roi Et\",\"Kalasin\",\"Ubon Ratchathani\",\"Kanchanaburi\",\"Trat\",\"Chumphon\",\"Nong Bua Lam Phu\",\"Lop Buri\",\"Phitsanulok\",\"Chiang Rai\",\"Nakhon Si Thammarat\",\"Nan\",\"Ang Thong\",\"Trang\",\"Surin\",\"Prachuap Khiri Khan\",\"Samut Prakan\"],[-0.45306,-0.45469,0.46449,-0.47429,-0.47755,0.49224,0.50204,0.50367,0.5069399999999999,-0.51184,-0.53469,0.53633,-0.55265,0.55265,0.55755,-0.56571,0.56571,0.58204,0.58367,-0.58694,0.59184,0.60163,-0.63592,-0.65224,0.73388,-0.4302,-0.43184,-0.43347,0.43673,0.41388,0.37959,0.37469,-0.37469,0.3698,0.3698,-0.3649,-0.3649,0.35837,0.35184,-0.3502,-0.34367,0.34367,-0.34204,0.34204,-0.33878,-0.33878,-0.33224,0.33224,0.32898,0.32735,0.32735,-0.32735,-0.31918,0.31429,0.31265,-0.29959,-0.29469,-0.29306,0.2849,-0.27347,0.26857,-0.26204,-0.25551,0.25224,-0.23265,0.21959,-0.21633,-0.2098,-0.19347,0.15429,0.15102,-0.10694,0.05306,-0.04327,-0.04,-0.01388,-0.00245],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1e-05,1e-05,1e-05,1e-05,2e-05,0.0001,0.00013,0.00013,0.00016,0.00016,0.00019,0.00019,0.00025,0.00032,0.00034,0.00044,0.00044,0.00047,0.00047,0.00053,0.00053,0.00068,0.00068,0.00077,0.00082,0.00082,0.00082,0.00111,0.00132,0.0014,0.0022,0.0026,0.00275,0.0036,0.00521,0.00608,0.00743,0.00906,0.009979999999999999,0.01752,0.02498,0.02722,0.03224,0.04837,0.11581,0.12377,0.27685,0.59241,0.6635799999999999,0.68804,0.89353,0.98665],[-555,-557,569,-581,-585,603,615,617,621,-627,-655,657,-677,677,683,-693,693,713,715,-719,725,737,-779,-799,899,-527,-529,-531,535,507,465,459,-459,453,453,-447,-447,439,431,-429,-421,421,-419,419,-415,-415,-407,407,403,401,401,-401,-391,385,383,-367,-361,-359,349,-335,329,-321,-313,309,-285,269,-265,-257,-237,189,185,-131,65,-53,-49,-17,-3],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n# Overnight Guest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for revenue/overnight guest\nemerging <- mann_kendall_function(th_bound_nb, \"revenue_tourist_stay\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-88002073c6d417dd20b3\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-88002073c6d417dd20b3\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Loei\",\"Phrae\",\"Prachuap Khiri Khan\",\"Chiang Mai\",\"Samut Prakan\",\"Phangnga\",\"Lop Buri\",\"Phatthalung\",\"Prachin Buri\",\"Phetchabun\",\"Sakon Nakhon\",\"Tak\",\"Sa Kaeo\",\"Nakhon Sawan\",\"Nakhon Pathom\",\"Kamphaeng Phet\",\"Sukhothai\",\"Chanthaburi\",\"Phayao\",\"Pattani\",\"Chiang Rai\",\"Satun\",\"Uthai Thani\",\"Phitsanulok\",\"Phuket\",\"Udon Thani\",\"Ang Thong\",\"Kalasin\",\"Roi Et\",\"Nakhon Ratchasima\",\"Phetchaburi\",\"Nakhon Phanom\",\"Suphan Buri\",\"Trang\",\"Mae Hong Son\",\"Samut Songkhram\",\"Buri Ram\",\"Nakhon Nayok\",\"Trat\",\"Lamphun\",\"Mukdahan\",\"Saraburi\",\"Surat Thani\",\"Amnat Charoen\",\"Chai Nat\",\"Ratchaburi\",\"Bueng Kan\",\"Nan\",\"Nonthaburi\",\"Surin\",\"Pathum Thani\",\"Rayong\",\"Sing Buri\",\"Chachoengsao\",\"Kanchanaburi\",\"Phichit\",\"Ubon Ratchathani\",\"Narathiwat\",\"Chaiyaphum\",\"Samut Sakhon\",\"Maha Sarakham\",\"Songkhla\",\"Krabi\",\"Nong Khai\",\"Chumphon\",\"Bangkok\",\"Nong Bua Lam Phu\",\"Uttaradit\",\"Khon Kaen\",\"Chon Buri\",\"Nakhon Si Thammarat\",\"Lampang\",\"Yala\",\"Phra Nakhon Si Ayutthaya\",\"Yasothon\",\"Ranong\",\"Si Sa Ket\"],[0.44653,0.45796,-0.47429,0.50857,-0.52163,-0.53306,-0.55592,-0.64408,-0.65061,0.42367,0.42531,0.42531,0.44,0.44327,0.41224,0.41388,0.42204,0.40735,-0.41061,-0.38776,-0.38286,-0.38286,0.37796,0.37469,0.37306,-0.37143,0.36816,-0.35837,-0.3551,-0.34531,-0.33878,0.33551,0.32898,-0.32082,-0.31265,0.30776,-0.30286,-0.30122,-0.30122,0.29796,0.29633,0.28816,-0.28816,0.27347,0.25061,-0.24408,0.23918,0.22776,0.22286,-0.21796,-0.2098,0.20327,-0.20163,0.1951,0.1902,-0.1902,-0.18857,-0.18694,-0.17061,0.17061,0.15755,0.15755,-0.14122,-0.13143,0.12653,-0.1249,-0.1151,-0.10367,0.09714,-0.07918,-0.06776,0.06122,-0.05796,-0.0449,-0.02694,0.02204,-0.01061],[0,0,0,0,0,0,0,0,0,1e-05,1e-05,1e-05,1e-05,1e-05,2e-05,2e-05,2e-05,3e-05,3e-05,6.999999999999999e-05,9.000000000000001e-05,9.000000000000001e-05,0.00011,0.00013,0.00014,0.00015,0.00017,0.00025,0.00028,0.00042,0.00053,0.0005999999999999999,0.00077,0.00104,0.0014,0.00166,0.00197,0.00208,0.00208,0.00233,0.00246,0.00324,0.00324,0.00521,0.01048,0.01268,0.01458,0.02005,0.02289,0.02608,0.03224,0.03803,0.03961,0.0465,0.0523,0.0523,0.05436,0.0565,0.08187999999999999,0.08187999999999999,0.10826,0.10826,0.15022,0.18077,0.19768,0.20357,0.24157,0.2919,0.32362,0.42196,0.49276,0.53592,0.55818,0.6514799999999999,0.78895,0.82783,0.92004],[547,561,-581,623,-639,-653,-681,-789,-797,519,521,521,539,543,505,507,517,499,-503,-475,-469,-469,463,459,457,-455,451,-439,-435,-423,-415,411,403,-393,-383,377,-371,-369,-369,365,363,353,-353,335,307,-299,293,279,273,-267,-257,249,-247,239,233,-233,-231,-229,-209,209,193,193,-173,-161,155,-153,-141,-127,119,-97,-83,75,-71,-55,-33,27,-13],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run for proportion of tourist who stay overnight\nemerging <- mann_kendall_function(th_bound_nb, \"tourist_stay_all\")\n\n# Visualize output\ndatatable(emerging, rownames=FALSE, width=\"100%\",\n            options=list(initComplete = JS(\n    \"function(settings, json) {\",\n    \"$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\",\n    \"$(this.api().table().body()).css({'font-family': 'sans-serif'});\",\n    \"}\"\n  )))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"htmlwidget-d26041764cde92f2653f\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d26041764cde92f2653f\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Maha Sarakham\",\"Samut Songkhram\",\"Mukdahan\",\"Suphan Buri\",\"Phangnga\",\"Yala\",\"Trat\",\"Surat Thani\",\"Prachin Buri\",\"Trang\",\"Sakon Nakhon\",\"Sing Buri\",\"Nakhon Nayok\",\"Chumphon\",\"Nakhon Pathom\",\"Tak\",\"Lampang\",\"Nakhon Phanom\",\"Uthai Thani\",\"Kalasin\",\"Kanchanaburi\",\"Sukhothai\",\"Phetchaburi\",\"Chachoengsao\",\"Roi Et\",\"Lamphun\",\"Ratchaburi\",\"Bueng Kan\",\"Nong Khai\",\"Pathum Thani\",\"Nonthaburi\",\"Sa Kaeo\",\"Amnat Charoen\",\"Loei\",\"Phatthalung\",\"Chanthaburi\",\"Rayong\",\"Narathiwat\",\"Khon Kaen\",\"Phetchabun\",\"Phuket\",\"Chon Buri\",\"Surin\",\"Yasothon\",\"Nakhon Si Thammarat\",\"Nong Bua Lam Phu\",\"Lop Buri\",\"Nakhon Sawan\",\"Phrae\",\"Chiang Rai\",\"Nan\",\"Satun\",\"Nakhon Ratchasima\",\"Chiang Mai\",\"Bangkok\",\"Phichit\",\"Kamphaeng Phet\",\"Samut Prakan\",\"Udon Thani\",\"Pattani\",\"Ranong\",\"Mae Hong Son\",\"Phra Nakhon Si Ayutthaya\",\"Si Sa Ket\",\"Chaiyaphum\",\"Uttaradit\",\"Phayao\",\"Samut Sakhon\",\"Ang Thong\",\"Prachuap Khiri Khan\",\"Saraburi\",\"Krabi\",\"Ubon Ratchathani\",\"Buri Ram\",\"Chai Nat\",\"Songkhla\",\"Phitsanulok\"],[-0.44816,-0.45633,-0.46286,-0.46286,0.47265,-0.47755,0.5069399999999999,-0.4351,0.44,0.44163,-0.44327,0.41551,0.40408,0.39102,-0.39102,0.39102,-0.3698,-0.36653,-0.3649,0.36,-0.33551,-0.33388,-0.33224,-0.33061,0.32245,0.31755,0.31265,-0.31102,-0.30449,0.30286,-0.29633,0.2898,-0.28653,0.26204,0.26041,0.25714,0.25551,-0.24571,0.23265,-0.23102,0.22776,-0.21959,0.21633,0.21306,-0.20653,0.20163,0.19347,0.17878,-0.16898,-0.15429,-0.14612,-0.14122,0.1151,0.11347,-0.11184,0.10857,-0.10531,0.10041,-0.09878000000000001,-0.09551,-0.09061,-0.07918,0.06776,-0.06286,0.05959,-0.05796,0.05143,-0.0498,0.04816,0.04163,-0.03837,-0.0351,-0.02694,0.01714,0.01224,0.01224,-0.00735],[0,0,0,0,0,0,0,1e-05,1e-05,1e-05,1e-05,2e-05,4e-05,6e-05,6e-05,6e-05,0.00016,0.00018,0.00019,0.00023,0.0005999999999999999,0.0006400000000000001,0.00068,0.00073,0.00098,0.00117,0.0014,0.00148,0.00186,0.00197,0.00246,0.00306,0.00341,0.00743,0.00781,0.008630000000000001,0.00906,0.01209,0.01752,0.01833,0.02005,0.02498,0.02722,0.02964,0.03504,0.03961,0.04837,0.06822,0.08486,0.11581,0.1365,0.15022,0.24157,0.24836,0.25528,0.26952,0.2843,0.30749,0.31548,0.33189,0.3575,0.42196,0.49276,0.52495,0.54699,0.55818,0.60402,0.61574,0.62756,0.67577,0.7004,0.7253500000000001,0.78895,0.86714,0.90677,0.90677,0.94665],[-549,-559,-567,-567,579,-585,621,-533,539,541,-543,509,495,479,-479,479,-453,-449,-447,441,-411,-409,-407,-405,395,389,383,-381,-373,371,-363,355,-351,321,319,315,313,-301,285,-283,279,-269,265,261,-253,247,237,219,-207,-189,-179,-173,141,139,-137,133,-129,123,-121,-117,-111,-97,83,-77,73,-71,63,-61,59,51,-47,-43,-33,21,15,15,-9],[1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225,1225],[14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667,14291.667]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>ADM1_EN<\\/th>\\n      <th>tau<\\/th>\\n      <th>sl<\\/th>\\n      <th>S<\\/th>\\n      <th>D<\\/th>\\n      <th>varS<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"initComplete\":\"function(settings, json) {\\n$(this.api().table().header()).css({'background-color': '#000', 'color': '#fff', 'font-family': 'sans-serif'});\\n$(this.api().table().body()).css({'font-family': 'sans-serif'});\\n}\",\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5]},{\"name\":\"ADM1_EN\",\"targets\":0},{\"name\":\"tau\",\"targets\":1},{\"name\":\"sl\",\"targets\":2},{\"name\":\"S\",\"targets\":3},{\"name\":\"D\",\"targets\":4},{\"name\":\"varS\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[\"options.initComplete\"],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n:::\n\nLooking at the Mann-Kendall Tsst across various key indicators, it shows provinces that are emerging hotspots and others that are emerging coldspots.\n\nSpecifically for Bangkok, while some key indicators are not statistically significant, it shows how it is an emerging coldspot with negative tau for revenue per tourist (foreign and Thai), suggesting the impact of Covid.\n\n## 5.3 Emerging Hotspot Analysis\n\nSimilar to Mann-Kendall's Test, a function will be used for visualizing the output across different key indicators. Inspiration for the visualization (using a color mapper and histogram within the tmap plot) was taken from 1 of the previous seniors.\n\nThe functions for visualizing EHSA is as follows:\n\n1.  Join the output to the original geospatial dataset\n2.  Load the color mapping\n3.  Filter the merged output from step 1 to include only statistically significant results\n4.  Visualize EHSA output with `tmap` (including a histogram of the category counts)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Category List \ncategory_list <- c(\"consecutive coldspot\", \"consecutive hotspot\", \"new coldspot\", \"new hotspot\", \"no pattern detected\", \"intensifying coldspot\", \"intensifying hotspot\", \"oscilating coldspot\", \"oscilating hotspot\", \"persistent coldspot\", \"persistent hotspot\", \"sporadic coldspot\", \"sporadic hotspot\"\n)\n\n# Color List\ncolor_list <- c(\"#83CBEB\", \"#FF6161\", \"#DCEAF7\", \"#FFB3B3\", \"#7F7F7F\", \"#4E95D9\", \"#FF0101\",\n  \"#D86ECB\", \"#F87306\", \"#104862\", \"#C00000\", \"#F2CFEE\", \"#FCB67C\")\n\n# Color Mapping Function\ncolor_mapping <- function(category_list, color_list, mapping) {\n  color <- rep(NA, length(mapping))\n  for (i in seq_along(mapping))\n  {\n    match_index <- match(mapping[i], category_list)\n    if (!is.na(match_index)) {\n      color[i] <- color_list[match_index]\n    }\n  }\n  return(color)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize ehsa\nehsa_fun <- function(ehsa) {\n  \n  th_ehsa <- th_bound %>%\n    left_join(ehsa, by = join_by(ADM1_EN == location))\n  \n  \n  th_ehsa_sig <- th_ehsa  %>%\n    filter(p_value < 0.05)\n  \n  color_mapping <- color_mapping(category_list, color_list, sort(unique(th_ehsa_sig$classification)))\n  \n  \n  tm_shape(th_ehsa) +\n    tm_polygons() +\n    tm_borders(alpha = 0.5) +\n    tm_shape(th_ehsa_sig) +\n    tm_fill(\"classification\", title = \"Classification\", palette = color_mapping,\n            legend.hist = TRUE, legend.hist.z = 0.1) + \n    tm_borders(alpha = 0.4) +\n    tm_layout(main.title = \"Emerging Hotspots & Coldspots\",\n              main.title.position = \"center\",\n              main.title.size = 0.8,\n              main.title.fontface = \"bold\",\n              legend.title.size = 0.6,\n              legend.text.size = 0.6,\n              legend.hist.width = 0.5)\n}\n```\n:::\n\n\n\n::: panel-tabset\n# Revenue\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_thai_prop\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_thai_prop.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_thai_prop.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Thai Revenue Proportion\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-109-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_foreign_prop\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_foreign_prop.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_foreign_prop.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Foreign Revenue Proportion\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-112-1.png){width=576}\n:::\n:::\n\n\n\n# Revenue/Tourist\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_tourist_all\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_tourist_all.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_tourist_all.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Revenue/Tourist\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-115-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_tourist_thai\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_tourist_thai.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_tourist_thai.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Revenue/Tourist (Thai)\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-118-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_tourist_foreign\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_tourist_foreign.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_tourist_foreign.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Revenue/Tourist (Foreign)\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-121-1.png){width=576}\n:::\n:::\n\n\n\n# Overnight Guest\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"revenue_tourist_stay\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_revenue_tourist_stay.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_revenue_tourist_stay.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Revenue/Overnight Guest\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-124-1.png){width=576}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set seed\nset.seed(42)\n\n# Run emerging hotspot analysis\nehsa <- emerging_hotspot_analysis(x = th_bound_spt, .var = \"tourist_stay_all\", k = 1, nsim = 99)\n```\n:::\n\n\n\nResults are saved for ease of rendering\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Export output object and read it in to minimize rendering time\n# write_rds(ehsa, 'data/output/ehsa_tourist_stay_all.rds') # Uncomment when running the ehsa again\n\n# Read in output object\nehsa <- read_rds('data/output/ehsa_tourist_stay_all.rds')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize for Proportion fo Tourists who stay overnight\nehsa_fun(ehsa)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-127-1.png){width=576}\n:::\n:::\n\n\n:::\n\nSimilar to previous analysis, the result of Thai revenue proportion is a mirror of Foreign revenue proportion. A possible impact of Covid can be inferred from the large volume of sporadic coldspots for foreign revenue proportion and revenue per tourist.\n\nAlthough majority of provinces are sporadic coldspot for revenue per tourist (foreign), there are a sizable number of provinces with that are sporadic hostpot, suggesting a potential rise in appeal of those provinces to foreign tourists. \n\nLooking at the overnight guests key indicators, there are a few intensifying coldspots (Chiang Rai and Phang Nga), indicating that the intensity of the cold spot has a statistically significant increase over time. This could be an impact of covid causing lesser tourists to decide staying overnight in those areas. \n\n# 6 Conclusion\n\nThrough Global Moran's I, I have established that the key indicators of Thailand's tourism economy is spatially dependent and spatio-temporal dependent. Local Moran's I was then used to further dive into how the individual provinces are to explore where the clusters/outliers are for different key indicators.\n\nExploratory Mann-Kendall and Emerging Hotspot Analysis are then used to highlight how those cluster/outliers change over time.\n\nThrough this, I deduce that there are a few key tourism areas. Bangkok is a consistent outlier (\"High-Low\") when performing Local Moran's I for several key indicators. \n\nPhuket is also another region, although different analysis points to how its surrounding provinces have been impact (by covid) over time. While those provinces are (\"High-High\") on foreign revenue proportion, they have been shown to decline over time (\"Sporadic coldspots\"), with Phang Nga especially being an intensifying coldspot for proportion of tourists staying overnight. \n\nOther regions include those in the middle (i.e. Uthai Thani), which are largely driven by domestic tourism in general. \n\n",
    "supporting": [
      "Take-Home_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/selectize-0.12.4/css/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/selectize-0.12.4/js/selectize.min.js\"></script>\n<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-ext-fixedcolumns-1.13.6/css/fixedColumns.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-ext-fixedcolumns-1.13.6/js/dataTables.fixedColumns.min.js\"></script>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<link href=\"../../site_libs/bootstrap-grid-3.4.1/bootstrap-grid.min.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}